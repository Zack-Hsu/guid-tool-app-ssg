(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4576],{22941:e=>{e.exports={navBar:"NavBar_navBar__RIFoT",navBar_transparent:"NavBar_navBar_transparent__mjQ_k",navBar_onlyRight:"NavBar_navBar_onlyRight__u33BW",centerSection:"NavBar_centerSection__G_ydK",rightSection:"NavBar_rightSection__uKxDH",leftSection:"NavBar_leftSection__3Uld4",backButton:"NavBar_backButton__x__IG",backText:"NavBar_backText__AiDBE",textContent:"NavBar_textContent__lAlWk",textContentClickable:"NavBar_textContentClickable__ULa0I",title:"NavBar_title__452Gj",subtitle:"NavBar_subtitle__UMvqQ",rightButton:"NavBar_rightButton__k0HNy",saveIcon:"NavBar_saveIcon__WmdPr"}},28404:(e,a,n)=>{"use strict";n.d(a,{IZ:()=>d,Q0:()=>u,QE:()=>f,Wy:()=>r,XL:()=>_,dg:()=>g,er:()=>v,iL:()=>c,nD:()=>o,sz:()=>l});var t=n(33252),i=n(91765);async function r(e,a){var n,r,o,c,l,s,u;let d=await (0,t.cy)();if(!d)return i.vF.warn("[PackageDataService] No package data"),null;let v=null==(n=d.info)?void 0:n[e];if(!v)return i.vF.warn("[PackageDataService] No info data in package for locale",{locale:e}),null;let f={name:v.name,title:v.title||v.name,sub_title:v.sub_title||"",img_key_vision:v.img_key_vision},g=((null==(o=d.exhibitions)||null==(r=o[e])?void 0:r[a])||[]).map(e=>({uid:e.uid,name:e.name,img_key_vision:e.img_key_vision,venue_locations:e.venue_locations||[]})),k=((null==(l=d.themes)||null==(c=l[e])?void 0:c[a])||[]).map(e=>{var a;return{uid:e.uid,name:e.name,img_key_vision:e.img_key_vision,duration_sec:e.duration_sec||0,num_works:(null==(a=e.works)?void 0:a.length)||0,target_audience:e.target_audience}}),_=(null==(u=d.works)||null==(s=u[e])?void 0:s[a])||[],h=_.filter(e=>e.is_popular).slice(0,10);return{venue:f,exhibitions:g,themes:k,works:(h.length>0?h:_.slice(0,10)).map(e=>{var a;return{uid:e.uid,name:e.name,img_key_vision:(null==(a=e.medias)?void 0:a[0])||{id:"",name:"",type:"photo",value:"",alt_text:e.name,media_sources:[]},venue_location:e.venue_location}})}}async function o(e,a){let n=await (0,t.cy)();if(!(null==n?void 0:n.exhibitions))return i.vF.warn("[PackageDataService] No exhibitions data in package"),[];let r=n.exhibitions[e];if(!r)return i.vF.warn("[PackageDataService] No exhibitions data for locale",{locale:e}),[];let o=r[a];return o||(i.vF.warn("[PackageDataService] No exhibitions data for version",{locale:e,version:a}),[])}async function c(e,a,n){var r,o,c,l;let s=await (0,t.cy)();if(!s)return null;let u=((null==(o=s.exhibitions)||null==(r=o[a])?void 0:r[n])||[]).find(a=>a.uid===e);if(!u)return null;if(u.works&&u.works.length>0)return u;if(u.work_binding&&u.work_binding.length>0){let t=(null==(l=s.works)||null==(c=l[a])?void 0:c[n])||[],r=new Set(u.work_binding.map(e=>e.uid));i.vF.debug("[PackageDataService] work_binding debug",{exhibitionUid:e,workBindingUids:Array.from(r),allWorksCount:t.length,allWorksUids:t.slice(0,5).map(e=>e.uid)});let o=t.filter(e=>r.has(e.uid));return i.vF.debug("[PackageDataService] Resolved works from work_binding",{exhibitionUid:e,workBindingCount:u.work_binding.length,resolvedWorksCount:o.length}),{...u,works:o}}return u}async function l(e,a,n){var r,o,c,l;let s=await (0,t.cy)();if(!s)return null;let u=((null==(o=s.themes)||null==(r=o[a])?void 0:r[n])||[]).find(a=>a.uid===e);if(!u)return null;if(u.works&&u.works.length>0)return u;if(u.work_binding&&u.work_binding.length>0){let t=(null==(l=s.works)||null==(c=l[a])?void 0:c[n])||[],r=new Set(u.work_binding.map(e=>e.uid)),o=t.filter(e=>r.has(e.uid));return i.vF.debug("[PackageDataService] Resolved works from work_binding for theme",{themeUid:e,workBindingCount:u.work_binding.length,resolvedWorksCount:o.length}),{...u,works:o}}return u}async function s(e,a){let n=await (0,t.cy)();if(!(null==n?void 0:n.works))return i.vF.warn("[PackageDataService] No works data in package"),[];let r=n.works[e];if(!r)return i.vF.warn("[PackageDataService] No works data for locale",{locale:e}),[];let o=r[a];return o||(i.vF.warn("[PackageDataService] No works data for version",{locale:e,version:a}),[])}async function u(e,a,n){var r,o,c,l;let u=await s(a,n);i.vF.debug("[PackageDataService] getWorkFromPackage",{workUid:e,locale:a,version:n,totalWorksCount:u.length,firstFewUids:u.slice(0,3).map(e=>e.uid)});let d=u.find(a=>a.uid===e);if(!d)return i.vF.warn("[PackageDataService] Work not found in package",{workUid:e}),null;if(i.vF.debug("[PackageDataService] Work found",{workUid:e,hasExhibitionUid:!!d.exhibition_uid,exhibitionUid:d.exhibition_uid}),d.exhibition_uid)return d;let v=await (0,t.cy)();if(!v)return d;for(let t of(null==(o=v.exhibitions)||null==(r=o[a])?void 0:r[n])||[]){if(null==(c=t.work_binding)?void 0:c.some(a=>a.uid===e))return i.vF.debug("[PackageDataService] Found exhibition for work via work_binding",{workUid:e,exhibitionUid:t.uid,exhibitionName:t.name}),{...d,exhibition_uid:t.uid,exhibition_name:t.name};if(null==(l=t.works)?void 0:l.some(a=>a.uid===e))return i.vF.debug("[PackageDataService] Found exhibition for work via works array",{workUid:e,exhibitionUid:t.uid,exhibitionName:t.name}),{...d,exhibition_uid:t.uid,exhibition_name:t.name}}return i.vF.debug("[PackageDataService] No exhibition found for work",{workUid:e}),d}async function d(e,a,n){return(await s(a,n)).find(a=>a.exhibit_number===e)||null}async function v(e,a){let n=await (0,t.cy)();if(!(null==n?void 0:n.info))return i.vF.warn("[PackageDataService] No venue info data in package"),null;let r=n.info[e];return r||(i.vF.warn("[PackageDataService] No venue info data for locale",{locale:e}),null)}async function f(){let e=await (0,t.cy)();return(null==e?void 0:e.system)?e.system:(i.vF.warn("[PackageDataService] No system data in package"),null)}async function g(e){let a=await (0,t.cy)();return(null==a?void 0:a.areas)?a.areas:(i.vF.warn("[PackageDataService] No areas data in package"),[])}async function k(){let e=await (0,t.cy)();return(null==e?void 0:e.beacons)?e.beacons:(i.vF.warn("[PackageDataService] No beacons data in package"),[])}async function _(e){return(await k()).find(a=>a.beacon_id===e)||null}},35566:(e,a,n)=>{"use strict";n.d(a,{A:()=>l});var t=n(81556),i=n(52728),r=n(34739),o=n(22941),c=n.n(o);function l(e){let{title:a,subtitle:n,showBack:o=!1,showBackArrow:l=!1,showHideIcon:s=!1,showLeftSection:u=!0,showSubtitle:d=!1,showRight:v=!1,rightButtonType:f="help",isFavorited:g=!1,variant:k="default",layout:_="default",onBackClick:h,onTitleClick:w,onRightClick:m,className:b=""}=e,y=(0,r.c3)("common"),x="transparent"===k?c().navBar_transparent:"",S="only-right"===_?c().navBar_onlyRight:"";return(0,t.jsxs)("nav",{className:"".concat(c().navBar," ").concat(x," ").concat(S," ").concat(b),"data-component":"NavBar","data-variant":k,"data-layout":_,children:["default"===_&&(0,t.jsx)("div",{className:c().leftSection,children:u&&(0,t.jsxs)(t.Fragment,{children:[s&&(0,t.jsx)("button",{onClick:h,className:c().backButton,"aria-label":y("close"),children:(0,t.jsx)(i.Oe,{})}),l&&!s&&(0,t.jsxs)("button",{onClick:h,className:c().backButton,"aria-label":y("back"),children:[(0,t.jsx)(i.iG.Outline,{}),o&&(0,t.jsx)("span",{className:c().backText,children:y("back")})]}),!l&&!o&&!s&&(0,t.jsx)(i.Oe,{})]})}),(0,t.jsx)("div",{className:c().centerSection,children:a&&(0,t.jsxs)("div",{className:"".concat(c().textContent," ").concat(w?c().textContentClickable:""),onClick:w,role:w?"button":void 0,tabIndex:w?0:void 0,children:[(0,t.jsx)("h1",{className:c().title,children:a}),d&&n&&(0,t.jsx)("p",{className:c().subtitle,children:n})]})}),(0,t.jsx)("div",{className:c().rightSection,children:v&&(0,t.jsx)("button",{onClick:m,className:c().rightButton,"aria-label":y("save"===f?"save":"help"===f?"info":"favorite"===f?g?"unfavorite":"favorite":"close"),children:"save"===f?(0,t.jsx)(i.iW,{}):"help"===f?(0,t.jsx)(i.Lw.Outline,{}):"favorite"===f?g?(0,t.jsx)(i.CC.Filled,{}):(0,t.jsx)(i.CC.Outline,{}):(0,t.jsx)(i.gz,{})})})]})}},41114:(e,a,n)=>{"use strict";n.d(a,{$F:()=>s,If:()=>g,K:()=>k,LH:()=>v,UD:()=>d,_X:()=>u,lM:()=>f});var t=n(97290),i=n(26945),r=n(22430),o=n(91765),c=n(754);async function l(){return"undefined"!=typeof navigator&&navigator.onLine}async function s(e){let a;t.$W.features.mockData?(a=(0,i.yL)(e),o.vF.debug("[dataService] Using mock data",{endpoint:e,mockUrl:a})):a=new URL(e,t.$W.apiUrl||"http://localhost:3020/api").toString();let n=await fetch(a);if(!n.ok)throw Error("API request failed: ".concat(n.statusText));let r=await n.json();return r.success&&r.data?r.data:r}async function u(e){let a=await (0,r.KK)(e);if(!a)throw Error("No local data available");return a}async function d(e,a){await (0,r.lj)(e,a)}async function v(e){await (0,r.hA)(e)}function f(e,a,n){return n?"".concat(e,"_").concat(n,"_").concat(a):"".concat(e,"_").concat(a)}async function g(e){let{endpoint:a,storageKey:n,serviceName:t,errorMessage:i="無法取得資料，請檢查網路連線"}=e;try{if(!await l())return await u(n);try{let e=await s(a);return d(n,e).catch(e=>o.vF.error("Failed to save ".concat(t," data to local storage"),{error:e instanceof Error?e.message:String(e),endpoint:a,storageKey:n})),e}catch(e){return o.vF.warn("API failed for ".concat(t,", falling back to local data"),{error:e instanceof Error?e.message:String(e),endpoint:a,storageKey:n}),await u(n)}}catch(e){throw o.errorTracker.report(e instanceof Error?e:Error(String(e)),{errorCode:o.F4.LOCALSTORAGE_ERROR,component:t,action:"fetchOfflineFirst",severity:c.MU.HIGH,metadata:{endpoint:a,storageKey:n}}),Error(i)}}async function k(e){let{endpoint:a,storageKey:n}=e,t=await s(a);return await d(n,t),t}},47077:(e,a,n)=>{"use strict";n.d(a,{$4:()=>g,NI:()=>f,X5:()=>u,dj:()=>d,yV:()=>s});var t=n(26945),i=n(91765),r=n(41114),o=n(28404),c=n(85110);let l="system_info";async function s(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zh-TW",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"adult";if(await (0,c.j1)()){i.vF.debug("[systemInfoService] Using offline mode",{});let e=await (0,o.QE)();if(!e)throw Error("離線模式下無法取得系統資訊，請確認已下載離線資料包");return{venues:[e]}}let n=(0,r.lM)(l,e,a);try{try{let e=await (0,r._X)(n);if(e)return i.vF.debug("[systemInfoService] Using cached system info",{}),e}catch(e){i.vF.debug("[systemInfoService] No cache found, fetching from API",{})}i.vF.info("[systemInfoService] Fetching system info from API",{});let e=await v();return await (0,r.UD)(n,e),e}catch(e){throw i.vF.error("[systemInfoService] Error getting system info",{error:e}),e}}async function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zh-TW",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"adult",n=(0,r.lM)(l,e,a);try{i.vF.info("[systemInfoService] Refreshing system info from API",{});let e=await v();return await (0,r.UD)(n,e),e}catch(e){throw i.vF.error("[systemInfoService] Error refreshing system info",{error:e}),e}}async function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zh-TW",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"adult",n=(0,r.lM)(l,e,a);await (0,r.LH)(n),i.vF.info("[systemInfoService] System info cache cleared",{})}async function v(){let e=t.Sn.SYSTEM_INFO();return i.vF.debug("[systemInfoService] Fetching from API",{endpoint:e}),await (0,r.$F)(e)}async function f(){return i.vF.info("[systemInfoService] Force fetching system info from server (ignoring offline mode)",{}),await v()}async function g(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zh-TW",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"adult";try{let n=await s(e,a);if(!n.venues||0===n.venues.length)throw Error("No venues available in system info");let t=n.venues[0].uid;return i.vF.info("[systemInfoService] Default venue_uid",{defaultVenueUid:t}),t}catch(e){throw i.vF.error("[systemInfoService] Error getting default venue_uid",{error:e}),e}}}}]);