(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7966],{5826:t=>{t.exports={tourIntro:"TourIntro_tourIntro___6eAZ",tourIntro__title:"TourIntro_tourIntro__title__p0iFX",tourIntro__info:"TourIntro_tourIntro__info__KN2VT",tourIntro__locationButtonWrapper:"TourIntro_tourIntro__locationButtonWrapper___fYtb",tourIntro__locationButton:"TourIntro_tourIntro__locationButton__IWPNb",tourIntro__worksPreview:"TourIntro_tourIntro__worksPreview__hLEZK",tourIntro__worksHeader:"TourIntro_tourIntro__worksHeader__lIvE6",tourIntro__worksHeaderRow:"TourIntro_tourIntro__worksHeaderRow__TkoJs",tourIntro__worksTitle:"TourIntro_tourIntro__worksTitle__6t616",tourIntro__viewMoreButton:"TourIntro_tourIntro__viewMoreButton__YdiPc",tourIntro__worksDivider:"TourIntro_tourIntro__worksDivider__KFVF3",tourIntro__worksList:"TourIntro_tourIntro__worksList__Da5j_",tourIntro__workCard:"TourIntro_tourIntro__workCard__NJMRc",tourIntro__workImageWrapper:"TourIntro_tourIntro__workImageWrapper__ODMye",tourIntro__workImage:"TourIntro_tourIntro__workImage__sicu2",tourIntro__workImageOverlay:"TourIntro_tourIntro__workImageOverlay__3e4yR",tourIntro__workTitle:"TourIntro_tourIntro__workTitle__fwO4C"}},10714:t=>{t.exports={worksListContainer:"TourWorksList_worksListContainer__0NIgk",worksListContainer__startButton:"TourWorksList_worksListContainer__startButton__AvCd4",worksListContainer__categories:"TourWorksList_worksListContainer__categories__wtId4",worksListContainer__category:"TourWorksList_worksListContainer__category__gYxop",worksListContainer__worksList:"TourWorksList_worksListContainer__worksList__MyCQz"}},57084:(t,e,r)=>{Promise.resolve().then(r.bind(r,73395))},73395:(t,e,r)=>{"use strict";r.d(e,{default:()=>M});var o=r(81556),a=r(47256),n=r(54961),i=r(34739),s=r(39660),_=r(89120),l=r(70254),u=r(53277),c=r(95610),d=r(70218),k=r(68793),w=r(52728),I=r(5826),m=r.n(I);let p=t=>{let{basicInfo:e,recommendStayTime:r,featuredWorks:a=[],onViewLocation:n,onViewMoreWorks:_,onWorkClick:l,className:u=""}=t,I=(0,i.c3)("tour"),p=[];if(e.targetAudience){let t="targetAudience.".concat(e.targetAudience),r=I.has(t)?I(t):e.targetAudience;p.push({label:I("audienceType"),value:r})}r&&p.push({label:I("duration"),value:I("durationValue",{minutes:r})});let h=[];return e.description&&h.push({type:"text",content:e.description}),e.videos&&e.videos.length>0&&e.videos.forEach(t=>{h.push({type:"video",video_url:t.videoURL,thumbnail:t.thumbnail})}),(0,o.jsxs)("div",{className:"".concat(m().tourIntro," ").concat(u),children:[(0,o.jsx)("h1",{className:m().tourIntro__title,children:e.title}),p.length>0&&(0,o.jsx)("div",{className:m().tourIntro__info,children:(0,o.jsx)(d.n,{items:p})}),n&&(0,o.jsx)("div",{className:m().tourIntro__locationButtonWrapper,children:(0,o.jsx)(c.$,{size:"small",fill:"outline",icon:w.yF,onClick:n,className:m().tourIntro__locationButton,children:I("viewLocation")})}),h.length>0&&(0,o.jsx)(k.U,{blocks:h}),a.length>0&&(0,o.jsxs)("div",{className:m().tourIntro__worksPreview,children:[(0,o.jsxs)("div",{className:m().tourIntro__worksHeader,children:[(0,o.jsxs)("div",{className:m().tourIntro__worksHeaderRow,children:[(0,o.jsx)("h2",{className:m().tourIntro__worksTitle,children:I("worksList")}),_&&(0,o.jsx)("button",{className:m().tourIntro__viewMoreButton,onClick:_,type:"button",children:I("viewMoreWorks")})]}),(0,o.jsx)("div",{className:m().tourIntro__worksDivider})]}),(0,o.jsx)("div",{className:m().tourIntro__worksList,children:a.map(t=>(0,o.jsxs)("div",{className:m().tourIntro__workCard,onClick:()=>null==l?void 0:l(t.workID),role:"button",tabIndex:0,onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),null==l||l(t.workID))},children:[(0,o.jsxs)("div",{className:m().tourIntro__workImageWrapper,children:[(0,o.jsx)(s.$,{src:t.image,alt:t.title,width:141,height:141,className:m().tourIntro__workImage}),(0,o.jsx)("div",{className:m().tourIntro__workImageOverlay})]}),(0,o.jsx)("span",{className:m().tourIntro__workTitle,children:t.title})]},t.workID))})]})]})};p.displayName="TourIntro";var h=r(72863),g=r(97360),v=r(28016),x=r(47469),f=r(71526),b=r(10714),D=r.n(b);let C=t=>{let e=Math.floor(t/60),r=Math.floor(t%60);return"".concat(e,":").concat(r.toString().padStart(2,"0"))},j=t=>{let{workCategories:e,tourID:r,tourName:n,className:s=""}=t,_=(0,i.c3)("tour"),{setPlaylist:l,play:u,currentTrack:c,subscribeToPlayHistory:d,getPlayHistorySnapshot:k}=(0,x.F)(),[I,m]=(0,a.useState)(!1),{getMediaInfoByVersion:p,worksToPlaylist:b}=(0,f.S)(),j=(0,a.useSyncExternalStore)(d,k,k),y=e.flatMap(t=>t.works),N=b(y,{exhibitionID:r,exhibitionName:n}),T=(0,a.useCallback)(()=>{0!==N.length&&(l(N,0),u(N[0]),m(!0))},[N,l,u]),L=(0,a.useCallback)((t,e)=>{let r=y.findIndex(e=>e.workID===t.workID);-1!==r&&(l(N,r),u(N[r]),m(!0))},[y,N,l,u]),H=(0,a.useCallback)(t=>(null==c?void 0:c.id)===t,[c]);return(0,o.jsxs)("div",{className:"".concat(D().worksListContainer," ").concat(s),children:[(0,o.jsx)(g.$,{size:"small",fill:"solid",icon:w.Dq.Outline,onClick:T,"aria-label":_(I?"restartTour":"startTour"),className:D().worksListContainer__startButton,children:_(I?"restartTour":"startTour")}),(0,o.jsx)("div",{className:D().worksListContainer__categories,children:e.map(t=>(0,o.jsxs)("div",{className:D().worksListContainer__category,children:[(0,o.jsx)(h.U,{title:t.categoryName}),(0,o.jsx)("div",{className:D().worksListContainer__worksList,children:t.works.map((t,e)=>{let r=p(t),a=!!r.duration,n=H(t.workID),i=t.has3DModel?"3d":null,s=r.contentID?j[r.contentID]:null,_=!!s&&!s.isCompleted,l=(null==s?void 0:s.duration)||r.duration||0,u=_?C(Math.max(0,l-s.progress)):void 0;return(0,o.jsx)(v.t,{image:t.image,title:t.title,location:{floor:t.floor||"",rooms:t.room?[t.room]:[]},status:n?"playing":_?"has-played":"default",hasAudio:a,duration:a?C(r.duration):void 0,remainingTime:u,progress:_?s.progressPercent:void 0,extraIcon:i,onClick:()=>L(t,e),imageAlt:t.title},t.workID)})})]},t.categoryID))})]})};j.displayName="TourWorksList";var y=r(93855),N=r(46682),T=r(66949),L=r(92432),H=r.n(L),B=r(76241);function M(){let t=(0,n.useParams)().id,e=(0,i.c3)("tour"),r=(0,i.c3)("common"),{data:c,loading:d,error:k,refresh:w}=function(t){let e=(0,_._)(),[r,o]=(0,a.useState)(null),[n,i]=(0,a.useState)(!0),[s,l]=(0,a.useState)(null),[u,c]=(0,a.useState)(!1),d=(0,a.useCallback)(async()=>{try{i(!0),l(null);let r=await e.tour.getDetail(t);o(r),c(!navigator.onLine)}catch(t){l(t instanceof Error?t:Error("Unknown error")),c(!0)}finally{i(!1)}},[t,e.tour]),k=(0,a.useCallback)(async()=>{try{i(!0),l(null);let r=await e.tour.refresh(t);o(r),c(!1)}catch(t){l(t instanceof Error?t:Error("Refresh failed")),c(!0)}finally{i(!1)}},[t,e.tour]);return(0,a.useEffect)(()=>{let t=()=>{c(!1),d()},e=()=>{c(!0)};return window.addEventListener("online",t),window.addEventListener("offline",e),()=>{window.removeEventListener("online",t),window.removeEventListener("offline",e)}},[d]),(0,a.useEffect)(()=>{d()},[d]),{data:r,loading:n,error:s,isOffline:u,refetch:d,refresh:k}}(t),[I,m]=(0,a.useState)("intro"),[h,g]=(0,a.useState)(!1),[v,b]=(0,a.useState)(!1),{setPlaylist:D,play:C,currentTrack:L,isExpanded:M}=(0,x.F)(),{getMediaInfoByVersion:W,worksToPlaylist:E}=(0,f.S)();(0,a.useEffect)(()=>{M&&h&&g(!1)},[M,h]);let[S,A]=(0,a.useState)(!1),U=(0,a.useRef)(null),O=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(!c||!U.current)return;let t=new IntersectionObserver(t=>{t.forEach(t=>{A(!t.isIntersecting)})},{root:null,rootMargin:"-56px 0px 0px 0px",threshold:[0,1]});return t.observe(U.current),()=>{t.disconnect()}},[c]);let R=(0,a.useCallback)(()=>{b(!0)},[]),F=(0,a.useCallback)(e=>{if(!c)return;let r=c.workCategories.flatMap(t=>t.works),o=r.findIndex(t=>t.workID===e.workID);if(-1===o)return;let a=E(r,{exhibitionID:t,exhibitionName:c.basicInfo.title});D(a,o),C(a[o])},[c,t,D,C,E]),P=(0,a.useMemo)(()=>{if(!c)return;let t=c.workCategories.flatMap(t=>t.works).filter(t=>t.mapLocation).map(t=>{let e=W(t);return{workId:t.workID,title:t.title,imageUrl:t.image,hasAudio:!!e.url,mapLocation:t.mapLocation,spaceUid:t.spaceUid,areaUid:t.floor}}),e=[...new Set(t.map(t=>t.spaceUid).filter(Boolean))],r=[...new Set(t.map(t=>t.areaUid).filter(Boolean))];return{exhibitionId:c.basicInfo.tourID,exhibitionName:c.basicInfo.title,areaColor:"rgba(221, 181, 134, 0.3)",spaceUids:e,areaUids:r,works:t}},[c,W]),K=(0,a.useCallback)(e=>{if(!c)return;let r=c.workCategories.flatMap(t=>t.works),o=r.findIndex(t=>t.workID===e);if(-1===o)return;let a=E(r,{exhibitionID:t,exhibitionName:c.basicInfo.title});D(a,o),C(a[o])},[c,t,D,C,E]);if(d)return(0,o.jsxs)("main",{className:H().tourDetail,children:[(0,o.jsx)(l.A,{title:r("loading"),showBackArrow:!0,showBack:!0,onBackClick:()=>window.history.back()}),(0,o.jsx)("div",{style:{padding:16},children:(0,o.jsx)("p",{children:r("loading")})})]});if(k)return(0,o.jsxs)("main",{className:H().tourDetail,children:[(0,o.jsx)(l.A,{title:r("error"),showBackArrow:!0,showBack:!0,onBackClick:()=>window.history.back()}),(0,o.jsxs)("div",{style:{padding:16},children:[(0,o.jsx)("p",{style:{color:"var(--scheme-error)"},children:k.message}),(0,o.jsx)("button",{onClick:w,style:{marginTop:8},children:r("refresh")})]})]});if(!c)return(0,o.jsxs)("main",{className:H().tourDetail,children:[(0,o.jsx)(l.A,{title:r("noContent"),showBackArrow:!0,showBack:!0,onBackClick:()=>window.history.back()}),(0,o.jsx)("div",{style:{padding:16},children:(0,o.jsx)("p",{children:r("noContent")})})]});let{basicInfo:Y}=c;return(0,o.jsxs)("div",{className:H().tourDetailWrapper,children:[(0,o.jsxs)("main",{className:H().tourDetail,"data-scroll-container":!0,children:[(0,o.jsx)(l.A,{title:S?Y.title:void 0,showBackArrow:!0,showRight:!0,rightButtonType:"help",variant:S?"default":"transparent",onBackClick:()=>window.history.back(),onRightClick:()=>{},className:H().tourDetail__navbar}),(0,o.jsx)("div",{ref:U,className:H().tourHeader,children:(0,o.jsxs)("div",{className:H().tourHeader__imageWrapper,children:[(0,o.jsx)(s.$,{src:Y.bannerImage,alt:Y.title,fill:!0,className:H().tourHeader__image,priority:!0}),(0,o.jsx)("div",{className:H().tourHeader__overlay})]})}),(0,o.jsx)("div",{ref:O,className:"".concat(H().tourDetail__tabContainer," ").concat(S?H().tourDetail__tabContainer_sticky:""),children:(0,o.jsx)(B.m,{children:(0,o.jsx)(u.o,{variant:"flat",activeLineMode:"full",isHeaderSticky:S,stickyTop:56,enableSwiper:!1,items:[{key:"intro",title:e("tabs.intro"),content:(0,o.jsx)(p,{basicInfo:Y,recommendStayTime:c.recommendStayTime,featuredWorks:c.featuredWorks,onViewLocation:R,onViewMoreWorks:()=>m("works"),onWorkClick:K})},{key:"works",title:e("tabs.works"),content:(0,o.jsx)("div",{style:{paddingTop:"16px"},children:(0,o.jsx)(j,{workCategories:c.workCategories,tourID:t,tourName:Y.title})})}],activeKey:I,onChange:t=>m(t)})})})]}),(0,o.jsx)(y.F,{onClick:()=>g(!0),bottomOffset:80*!!L}),(0,o.jsx)(N.T,{visible:h,onClose:()=>g(!1)}),(0,o.jsx)(T.D,{visible:v,onClose:()=>b(!1),mode:"tour",exhibition:P,onWorkActionClick:F})]})}},92432:t=>{t.exports={tourDetailWrapper:"page_tourDetailWrapper__RcuE9",tourDetail:"page_tourDetail__6ZCnf",tourDetail__navbar:"page_tourDetail__navbar__iYrsY",tourDetail__tabContainer:"page_tourDetail__tabContainer__Npaj7",tourDetail__banner:"page_tourDetail__banner__J_sXa",tourDetail__bannerImage:"page_tourDetail__bannerImage__aKDla",tourDetail__bannerImg:"page_tourDetail__bannerImg__TN36u",tourDetail__bannerOverlay:"page_tourDetail__bannerOverlay__dUEdY",tourDetail__bannerContent:"page_tourDetail__bannerContent__r2y_C",tourDetail__title:"page_tourDetail__title__Mtul2",tourDetail__subtitle:"page_tourDetail__subtitle__1QzHN",tourDetail__bannerMeta:"page_tourDetail__bannerMeta__m4txa",tourDetail__bannerMetaItem:"page_tourDetail__bannerMetaItem__vdXa1",tourDetail__tabs:"page_tourDetail__tabs__F1vk1",tourDetail__content:"page_tourDetail__content__z3P4T",tourHeader:"page_tourHeader__UD3GD",tourHeader__imageWrapper:"page_tourHeader__imageWrapper__f81M3",tourHeader__image:"page_tourHeader__image___Ml78",tourHeader__overlay:"page_tourHeader__overlay__9L54F",tourHeader__content:"page_tourHeader__content__62Tyq",tourHeader__title:"page_tourHeader__title__7h28x",tourHeader__metadata:"page_tourHeader__metadata__EW8oU",tourHeader__metadataItem:"page_tourHeader__metadataItem__mbG_2"}}},t=>{t.O(0,[4676,9152,7906,9681,7035,7020,4772,4730,3678,6208,4576,4078,1778,9120,664,443,8471,9402,5510,7358],()=>t(t.s=57084)),_N_E=t.O()}]);