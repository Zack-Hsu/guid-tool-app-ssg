(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5539],{10731:r=>{r.exports={cardFooterContent:"CardFooterContent_cardFooterContent__ifhn0",cardFooterContent__icon:"CardFooterContent_cardFooterContent__icon__Z20gW",cardFooterContent__time:"CardFooterContent_cardFooterContent__time__wa8IZ",cardFooterContent__progressBar:"CardFooterContent_cardFooterContent__progressBar__Vs7SH",cardFooterContent__playingText:"CardFooterContent_cardFooterContent__playingText__SSoOM",cardFooterContent__readingText:"CardFooterContent_cardFooterContent__readingText__Z4RIR","cardFooterContent--default":"CardFooterContent_cardFooterContent--default__g3Njh","cardFooterContent--has-played":"CardFooterContent_cardFooterContent--has-played__1jeb9","cardFooterContent--playing":"CardFooterContent_cardFooterContent--playing__FH0FZ","cardFooterContent--reading":"CardFooterContent_cardFooterContent--reading__CEST8"}},13989:r=>{r.exports={artworkCard:"ArtworkCard_artworkCard__T9VD_","artworkCard--clickable":"ArtworkCard_artworkCard--clickable__mi3AN","artworkCard--playing":"ArtworkCard_artworkCard--playing__v7vVm",artworkCard__title:"ArtworkCard_artworkCard__title__FQzux",artworkCard__imageWrapper:"ArtworkCard_artworkCard__imageWrapper__RQDFt",artworkCard__image:"ArtworkCard_artworkCard__image__ysWOs",artworkCard__body:"ArtworkCard_artworkCard__body__Dzhmv",artworkCard__header:"ArtworkCard_artworkCard__header__jGJbF",artworkCard__locationText:"ArtworkCard_artworkCard__locationText__jSFyL",artworkCard__footer:"ArtworkCard_artworkCard__footer__Cr7MM",artworkCard__extraIcon:"ArtworkCard_artworkCard__extraIcon__cJUzy"}},16321:r=>{r.exports={playHistoryPage:"PlayHistoryPage_playHistoryPage__M_NOl",content:"PlayHistoryPage_content__VuPvt","content--withMiniPlayer":"PlayHistoryPage_content--withMiniPlayer__ZHR9u",list:"PlayHistoryPage_list__FGULP",loading:"PlayHistoryPage_loading__HFnwj",empty:"PlayHistoryPage_empty__ZD_8w"}},28016:(r,t,e)=>{"use strict";e.d(t,{t:()=>_});var a=e(81556);e(47256);var o=e(39660),n=e(93171),i=e.n(n),s=e(95165),l=e(52728),d=e(13989),c=e.n(d);let _=r=>{let{image:t,title:e,location:n,status:d="default",hasAudio:_=!0,extraIcon:C=null,duration:u="1:22",remainingTime:h="0:56",progress:m=50,onClick:p,onExtraIconClick:y,className:k="",imageAlt:w}=r,g="".concat(n.floor," ").concat(n.rooms.join("、")),x=r=>{r.stopPropagation(),y&&C&&y(C)};return(0,a.jsxs)("div",{className:i()(c().artworkCard,{[c()["artworkCard--playing"]]:"playing"===d,[c()["artworkCard--hasPlayed"]]:"has-played"===d,[c()["artworkCard--clickable"]]:!!p},k),onClick:p,role:p?"button":void 0,tabIndex:p?0:void 0,onKeyDown:r=>{p&&("Enter"===r.key||" "===r.key)&&(r.preventDefault(),p())},children:[(0,a.jsx)("div",{className:c().artworkCard__imageWrapper,children:(0,a.jsx)(o.$,{src:t,alt:w||e,width:96,height:96,className:c().artworkCard__image,style:{objectFit:"cover"},lightweight:!0})}),(0,a.jsxs)("div",{className:c().artworkCard__body,children:[(0,a.jsxs)("div",{className:c().artworkCard__header,children:[(0,a.jsx)("span",{className:c().artworkCard__locationText,children:g}),(0,a.jsx)("h3",{className:c().artworkCard__title,children:e})]}),(0,a.jsxs)("div",{className:c().artworkCard__footer,children:[(_||"reading"===d)&&(0,a.jsx)(s.$,{status:d,duration:u,remainingTime:h,progress:m}),(()=>{if(!C)return null;let r="3d"===C?(0,a.jsx)(l.F6,{size:20,color:"gray","aria-hidden":"true"}):(0,a.jsx)(l.YY.Outline,{size:20,color:"gray","aria-hidden":"true"});return p?(0,a.jsx)("div",{className:c().artworkCard__extraIcon,onClick:x,"aria-hidden":"true",children:r}):(0,a.jsx)("button",{className:c().artworkCard__extraIcon,onClick:x,"aria-label":"3d"===C?"查看 3D 模型":"閱讀文章",type:"button",children:r})})()]})]})]})};_.displayName="ArtworkCard"},45844:(r,t,e)=>{Promise.resolve().then(e.bind(e,68210))},54961:(r,t,e)=>{"use strict";var a=e(60541);e.o(a,"permanentRedirect")&&e.d(t,{permanentRedirect:function(){return a.permanentRedirect}}),e.o(a,"redirect")&&e.d(t,{redirect:function(){return a.redirect}}),e.o(a,"useParams")&&e.d(t,{useParams:function(){return a.useParams}}),e.o(a,"usePathname")&&e.d(t,{usePathname:function(){return a.usePathname}}),e.o(a,"useRouter")&&e.d(t,{useRouter:function(){return a.useRouter}})},68210:(r,t,e)=>{"use strict";e.d(t,{PlayHistoryPage:()=>w});var a=e(81556),o=e(47256),n=e(34739),i=e(47251),s=e(54961),l=e(35566),d=e(28016),c=e(47469),_=e(7241),C=e(71526),u=e(85110),h=e(28353),m=e(93257),p=e(91765),y=e(16321),k=e.n(y);let w=()=>{let r=(0,n.c3)("settings"),t=(0,i.Ym)(),e=(0,s.useRouter)(),{play:y,setPlaylist:w,setWorkCategories:g,subscribeToPlayHistory:x,getPlayHistorySnapshot:F,currentTrack:f,visible:j}=(0,c.F)(),{version:v}=(0,_.t)(),{contentVersionType:P,worksToPlaylist:N}=(0,C.S)(),b=(0,o.useSyncExternalStore)(x,F,F),[D,I]=(0,o.useState)([]),[A,H]=(0,o.useState)(!0),R=(0,o.useCallback)(async()=>{H(!0);try{let r=await (0,u.BJ)(),e=await Promise.all(r.map(async r=>{try{var e,a;let o=await (0,h.pV)(r.workID,t,v);return{...r,title:o.title,floor:(null==(e=o.location)?void 0:e.floor)||r.floor,room:(null==(a=o.location)?void 0:a.room)||r.room}}catch(t){return r}}));I(e)}catch(r){p.errorTracker.report(r instanceof Error?r:Error(String(r)),{errorCode:p.F4.FILE_READ_ERROR,component:"PlayHistoryPage",action:"loadPlayHistory"})}finally{H(!1)}},[t,v]);(0,o.useEffect)(()=>{R()},[R]);let T=(0,o.useCallback)(()=>{e.back()},[e]),E=(0,o.useCallback)(async r=>{try{let e=await (0,h.pV)(r.workID,t,v),a={id:r.workID,title:r.title,thumbnail:r.thumbnail,exhibitionID:e.exhibitionID,exhibitionName:e.exhibitionName,floor:r.floor,room:r.room,has3DModel:r.has3DModel,contents:e.contents,contentVersionType:P};if(e.exhibitionID)try{let a=await (0,m.nW)(e.exhibitionID,t,v),o=a.workCategories.flatMap(r=>r.works);if(o.length>0){let t=e.exhibitionName||a.basicInfo.title,n=N(o,{exhibitionID:e.exhibitionID,exhibitionName:t}),i=n.findIndex(t=>t.id===r.workID);if(-1!==i){n[i]={...n[i],contents:e.contents},w(n,i),g(a.workCategories),y(n[i]);return}}}catch(r){}w([a],0),y(a)}catch(r){p.errorTracker.report(r instanceof Error?r:Error(String(r)),{errorCode:p.sc.DATA_LOAD_ERROR,component:"PlayHistoryPage",action:"playHistoryWork"})}},[t,v,P,N,y,w,g]),M=r=>{let t=Math.floor(r/60),e=Math.floor(r%60);return"".concat(t,":").concat(e.toString().padStart(2,"0"))};return(0,a.jsxs)("div",{className:k().playHistoryPage,children:[(0,a.jsx)(l.A,{title:r("personal.playHistory"),variant:"default",showBackArrow:!0,showBack:!1,showRight:!0,rightButtonType:"help",onBackClick:T}),(0,a.jsx)("div",{className:"".concat(k().content," ").concat(j&&f?k()["content--withMiniPlayer"]:""),children:A?(0,a.jsx)("div",{className:k().loading,children:(0,a.jsx)("p",{children:r("personal.loading")})}):0===D.length?(0,a.jsx)("div",{className:k().empty,children:(0,a.jsx)("p",{children:r("personal.noPlayHistory")})}):(0,a.jsx)("div",{className:k().list,children:D.map(r=>{var t,e;let o,n=b[r.contentID],i=null!=(t=null==n?void 0:n.progressPercent)?t:r.progressPercent,s=null!=(e=null==n?void 0:n.isCompleted)?e:r.isCompleted,l=!!n&&!s,c=r.has3DModel?"3d":null;return(0,a.jsx)(d.t,{image:r.thumbnail,title:r.title,location:{floor:r.floor||"",rooms:r.room?[r.room]:[]},status:(o=r.workID,(null==f?void 0:f.id)===o)?"playing":l?"has-played":"default",hasAudio:!0,duration:M(r.duration),remainingTime:(r=>{var t,e;let a=b[r.contentID],o=null!=(t=null==a?void 0:a.isCompleted)?t:r.isCompleted,n=null!=(e=null==a?void 0:a.progress)?e:r.progress;if(!o)return M(Math.max(0,r.duration-n))})(r),progress:i,extraIcon:c,onClick:()=>E(r)},"".concat(r.workID,"-").concat(r.contentID))})})})]})};w.displayName="PlayHistoryPage"},95165:(r,t,e)=>{"use strict";e.d(t,{$:()=>d});var a=e(81556);e(47256);var o=e(34739),n=e(83678),i=e(52728),s=e(10731),l=e.n(s);let d=r=>{let{status:t="default",duration:e="1:22",remainingTime:s="0:56",progress:d=50,className:c=""}=r,_=(0,o.c3)("workCard"),C=[l().cardFooterContent,l()["cardFooterContent--".concat(t)],c].filter(Boolean).join(" ");return"default"===t?(0,a.jsxs)("div",{className:C,"data-status":"default",children:[(0,a.jsx)(i.UG.Outline,{color:"white",size:12,className:l().cardFooterContent__icon}),(0,a.jsx)("span",{className:l().cardFooterContent__time,children:e})]}):"has-played"===t?(0,a.jsxs)("div",{className:C,"data-status":"has-played",children:[(0,a.jsx)(i.UG.Outline,{color:"white",size:12,className:l().cardFooterContent__icon}),(0,a.jsx)(n.z2,{percent:d,className:l().cardFooterContent__progressBar,style:{"--track-width":"3px","--track-color":"rgba(196, 196, 196, 0.5)","--fill-color":"var(--scheme-on-secondary-container)"}}),(0,a.jsxs)("span",{className:l().cardFooterContent__time,children:[(0,a.jsx)("span",{children:_("separator")}),(0,a.jsx)("span",{children:s})]})]}):"playing"===t?(0,a.jsxs)("div",{className:C,"data-status":"playing",children:[(0,a.jsx)(i.AW,{color:"gold",size:12,className:l().cardFooterContent__icon}),(0,a.jsx)("span",{className:l().cardFooterContent__playingText,children:_("playing")})]}):"reading"===t?(0,a.jsxs)("div",{className:C,"data-status":"reading",children:[(0,a.jsx)("span",{className:l().cardFooterContent__time,children:e}),(0,a.jsx)("span",{className:l().cardFooterContent__readingText,children:_("estimatedReadingTime")})]}):null};d.displayName="CardFooterContent"}},r=>{r.O(0,[4676,9152,7906,1104,4772,4730,3678,6208,4576,4078,1778,9402,5510,7358],()=>r(r.s=45844)),_N_E=r.O()}]);