(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6208],{754:(e,t,a)=>{"use strict";a.d(t,{MU:()=>r});var r=function(e){return e.LOW="low",e.MEDIUM="medium",e.HIGH="high",e.CRITICAL="critical",e}({})},3226:(e,t,a)=>{"use strict";a.d(t,{Dr:()=>_,WC:()=>p,clearOfflineModeCache:()=>g,clearResolvedImageCache:()=>d});var r=a(47256),o=a(22430),n=a(85110),i=a(91765);let s=null,l=null,c=new Map;function d(){c.clear()}async function u(){return null!==s?s:l||(l=(0,n.j1)().then(e=>(s=e,l=null,e)))}function g(){s=null,l=null}function _(e){s=e}function f(e){if(!e)return{src:"",isLoading:!1,isFromCache:!1};if(!1===s||null===s)return{src:e,isLoading:!1,isFromCache:!1};if(c.has(e)){let t=c.get(e);return t?{src:t,isLoading:!1,isFromCache:!0}:{src:"",isLoading:!1,isFromCache:!1,error:"No cached image available in offline mode"}}return{src:e,isLoading:!0,isFromCache:!1}}function p(e){let[t,a]=(0,r.useState)(()=>f(e));return(0,r.useEffect)(()=>{a(f(e))},[e]),(0,r.useEffect)(()=>{let t=!0;return async function(){if(!e)return a({src:"",isLoading:!1,isFromCache:!1});if(!c.has(e))try{if(!await u()){t&&a({src:e,isLoading:!1,isFromCache:!1});return}let r=(0,o.l)(e),n=e.substring(e.lastIndexOf("/")+1);i.vF.debug("[useOfflineImage] Offline mode: looking for fileId=".concat(r,", file=").concat(n));let s=await (0,o.al)(e);c.set(e,s),t&&(s?(i.vF.debug("[useOfflineImage] Using cached: fileId=".concat(r,", file=").concat(n)),a({src:s,isLoading:!1,isFromCache:!0})):(i.vF.warn("[useOfflineImage] NO CACHE for offline: fileId=".concat(r,", file=").concat(n)),a({src:"",isLoading:!1,isFromCache:!1,error:"No cached image available in offline mode"})))}catch(r){i.vF.error("[useOfflineImage] Error loading image",{error:r instanceof Error?r.message:String(r),remoteUrl:e.substring(0,50)+"..."}),t&&a({src:e,isLoading:!1,isFromCache:!1,error:r instanceof Error?r.message:"Unknown error"})}}(),()=>{t=!1}},[e]),t}},7241:(e,t,a)=>{"use strict";a.d(t,{SettingsProvider:()=>p,t:()=>E});var r=a(81556),o=a(47256),n=a(83576),i=a(7878),s=a(85110),l=a(33252),c=a(3226),d=a(97290),u=a(91765),g=a(754),_=a(85550);let f=(0,o.createContext)(void 0),p=e=>{let{children:t}=e,[a,p]=(0,o.useState)(i.a$),[E,m]=(0,o.useState)(!1),[v,I]=(0,o.useState)(!1),[R,A]=(0,o.useState)(!0),[y,O]=(0,o.useState)(null),[h,T]=(0,o.useState)(null),[S,M]=(0,o.useState)(!1),[F,w]=(0,o.useState)(0);(0,o.useEffect)(()=>{if(n.El.hasRun(n.El.KEYS.SETTINGS))return void m(!0);n.El.markAsRun(n.El.KEYS.SETTINGS),(async()=>{try{let e=await (0,s.mt)();(0,c.Dr)(e.isOfflineMode),p(e)}catch(e){u.vF.error("Failed to load settings",{error:e}),u.errorTracker.report(e,{errorCode:_.F4.FILE_READ_ERROR,component:"SettingsContext",action:"initializeSettings",severity:g.MU.MEDIUM}),(0,c.Dr)(i.a$.isOfflineMode),p(i.a$)}finally{m(!0)}})()},[]);let D=(0,o.useCallback)(async e=>{try{let t=a.version,r=t!==e;await (0,s.Un)(e),p(t=>({...t,version:e})),r&&(u.vF.info("Version changed, clearing personal data",{from:t,to:e}),await (0,s.E0)(),w(e=>e+1))}catch(t){throw u.vF.error("Failed to save version",{error:t,version:e}),u.errorTracker.report(t,{errorCode:_.F4.FILE_WRITE_ERROR,component:"SettingsContext",action:"setVersion",severity:g.MU.LOW}),t}},[a.version]),N=(0,o.useCallback)(async e=>{try{await (0,s.Mf)(e),p(t=>({...t,fontSize:e})),B(e)}catch(t){throw u.vF.error("Failed to save font size",{error:t,fontSize:e}),u.errorTracker.report(t,{errorCode:_.F4.FILE_WRITE_ERROR,component:"SettingsContext",action:"setFontSize",severity:g.MU.LOW}),t}},[]),L=(0,o.useCallback)(async()=>{try{await (0,s.A1)(!0),p(e=>({...e,isAdminMode:!0}))}catch(e){throw u.vF.error("Failed to enter admin mode",{error:e}),u.errorTracker.report(e,{errorCode:_.F4.FILE_WRITE_ERROR,component:"SettingsContext",action:"enterAdminMode",severity:g.MU.LOW}),e}},[]),b=(0,o.useCallback)(async()=>{try{await (0,s.A1)(!1),p(e=>({...e,isAdminMode:!1}))}catch(e){throw u.vF.error("Failed to exit admin mode",{error:e}),u.errorTracker.report(e,{errorCode:_.F4.FILE_WRITE_ERROR,component:"SettingsContext",action:"exitAdminMode",severity:g.MU.LOW}),e}},[]),k=(0,o.useCallback)(async()=>{try{await (0,s.E0)(),w(e=>e+1),u.vF.info("Personal data cleared successfully")}catch(e){throw u.vF.error("Failed to clear personal data",{error:e}),u.errorTracker.report(e,{errorCode:_.F4.FILE_WRITE_ERROR,component:"SettingsContext",action:"resetToDefaults",severity:g.MU.MEDIUM}),e}},[]),C=(0,o.useCallback)(e=>e===i.qw,[]),P=(0,o.useCallback)(async e=>{try{await (0,s.M7)(e),(0,c.Dr)(e),p(t=>({...t,isOfflineMode:e}))}catch(t){throw u.vF.error("Failed to save offline mode",{error:t,enabled:e}),u.errorTracker.report(t,{errorCode:_.F4.FILE_WRITE_ERROR,component:"SettingsContext",action:"setOfflineMode",severity:g.MU.LOW}),t}},[]),U=(0,o.useCallback)(async e=>{try{let t=new Date().toISOString();await Promise.all([(0,s.CW)(e),(0,s.Bi)(t)]),p(a=>({...a,packageVersion:e,lastPackageUpdate:t}))}catch(t){throw u.vF.error("Failed to update package info",{error:t,version:e}),u.errorTracker.report(t,{errorCode:_.F4.FILE_WRITE_ERROR,component:"SettingsContext",action:"updatePackageInfo",severity:g.MU.MEDIUM}),t}},[]),K=(0,o.useCallback)(async()=>{A(!0);try{let e=await (0,l._x)();if(I(e),n.El.setCachedValue("__HAS_LOCAL_PACKAGE__",e),e){let e=await (0,l.y$)();O(e)}else O(null);u.vF.debug("[Settings] Package status refreshed",{exists:e})}catch(e){u.vF.error("[Settings] Failed to check local package",{error:e}),I(!1),n.El.setCachedValue("__HAS_LOCAL_PACKAGE__",!1),O(null)}finally{A(!1)}},[]),W=(0,o.useCallback)(async(e,t)=>{if(S)return{success:!1,error:"Download already in progress"};M(!0),T(null);try{u.vF.info("[Settings] Starting package download",{venueUid:e,version:t});let a=await (0,l.Xo)(e,t,e=>{T(e)});if(a.success)return u.vF.info("[Settings] Package download completed"),await K(),T(null),{success:!0};return u.vF.error("[Settings] Package download failed",{error:a.error}),{success:!1,error:a.error}}catch(t){let e=t instanceof Error?t.message:String(t);return u.vF.error("[Settings] Failed to download package",{error:t}),T({status:"failed",totalFiles:0,completedFiles:0,overallProgress:0,error:e}),{success:!1,error:e}}finally{M(!1)}},[S,K]);(0,o.useEffect)(()=>{if(n.El.hasRun(n.El.KEYS.PACKAGE_STATUS)){let e=n.El.getCachedValue("__HAS_LOCAL_PACKAGE__");void 0!==e&&I(e),(async()=>{let e=await (0,l._x)();I(e),n.El.setCachedValue("__HAS_LOCAL_PACKAGE__",e),A(!1)})();return}n.El.markAsRun(n.El.KEYS.PACKAGE_STATUS),K()},[K]);let G=(0,o.useCallback)(()=>{let e=new Date,t=new Date(new Date(e.getTime()+288e5));t.setUTCHours(0,0,0,0);let a=new Date(t);a.setUTCDate(a.getUTCDate()+1);let r=a.getTime()-288e5-e.getTime();return r>0?r:864e5},[]),x=(0,o.useCallback)(async()=>{if(!(null==y?void 0:y.venueUid)||!(null==y?void 0:y.version))return void u.vF.debug("[Settings] AUTO_UPDATE: No package info, skipping update check");if(S)return void u.vF.debug("[Settings] AUTO_UPDATE: Download in progress, skipping");try{u.vF.info("[Settings] AUTO_UPDATE: Checking for updates...",{venueUid:y.venueUid,currentVersion:y.version});let a=await (0,l.S8)(y.venueUid,y.version);if(a.update_available){var e,t;let r=a.package_version.find(e=>e.is_latest),o=null!=(t=null==r?void 0:r.version)?t:null==(e=a.package_version[0])?void 0:e.version;u.vF.info("[Settings] AUTO_UPDATE: Update available, starting download",{newVersion:o,latestVersionInfo:r}),o?await W(y.venueUid,o):u.vF.warn("[Settings] AUTO_UPDATE: No version string available in update info")}else u.vF.info("[Settings] AUTO_UPDATE: No update available")}catch(e){u.vF.error("[Settings] AUTO_UPDATE: Failed to check/download update",{error:e})}},[y,S,W]);(0,o.useEffect)(()=>{if(!d.$W.offlineMode.autoUpdate||!d.$W.features.offlineMode||!v)return;u.vF.info("[Settings] AUTO_UPDATE: Scheduler initialized");let e=G(),t=new Date(Date.now()+e);u.vF.info("[Settings] AUTO_UPDATE: Next scheduled run",{msUntilMidnight:e,nextRunTime:t.toISOString()});let a=null,r=setTimeout(()=>{x(),a=setInterval(()=>{x()},864e5)},e);return()=>{clearTimeout(r),a&&clearInterval(a),u.vF.debug("[Settings] AUTO_UPDATE: Scheduler cleaned up")}},[v,G,x]);let B=e=>{"undefined"!=typeof document&&document.documentElement.setAttribute("data-font-size",e)};(0,o.useEffect)(()=>{E&&B(a.fontSize)},[a.fontSize,E]);let V=(0,o.useMemo)(()=>({version:a.version,fontSize:a.fontSize,isAdminMode:a.isAdminMode,isOfflineMode:a.isOfflineMode,packageVersion:a.packageVersion,lastPackageUpdate:a.lastPackageUpdate,setVersion:D,setFontSize:N,enterAdminMode:L,exitAdminMode:b,resetToDefaults:k,validateAdminPassword:C,setOfflineMode:P,updatePackageInfo:U,hasLocalPackage:v,isCheckingPackage:R,packageInfo:y,downloadProgress:h,isDownloading:S,refreshPackageStatus:K,downloadPackageData:W,personalDataVersion:F}),[a.version,a.fontSize,a.isAdminMode,a.isOfflineMode,a.packageVersion,a.lastPackageUpdate,D,N,L,b,k,C,P,U,v,R,y,h,S,K,W,F]);return(0,r.jsx)(f.Provider,{value:V,children:t})},E=()=>{let e=(0,o.useContext)(f);if(!e)throw Error("useSettings must be used within a SettingsProvider");return e}},7878:(e,t,a)=>{"use strict";a.d(t,{a$:()=>n,gI:()=>o,qw:()=>i});var r=a(13588);let o="normal",n={version:r.uv,fontSize:o,isAdminMode:!1,isOfflineMode:!1,packageVersion:void 0,lastPackageUpdate:void 0},i="ADMINARTOGO"},13588:(e,t,a)=>{"use strict";a.d(t,{Fc:()=>o,G2:()=>n,MB:()=>s,Nm:()=>i,uv:()=>c,v4:()=>l});var r=a(82305);let o=r.IB,n=r.L$,i=r.q,s=["adult","kids","sign_language","audio_description"],l={adult:"成人版",kids:"兒童版",sign_language:"手語版",audio_description:"音訊說明版"},c="adult"},22430:(e,t,a)=>{"use strict";a.d(t,{KK:()=>y,QW:()=>k,Si:()=>T,WA:()=>N,al:()=>D,checkNetworkType:()=>L,clearFileMappingCache:()=>m,hA:()=>O,l:()=>w,lj:()=>A,lr:()=>S});var r=a(39692),o=a(40696),n=a(45946),i=a(54798),s=a(91765),l=a(28496),c=a(67581);let d={FILES:"artogo/files"},u=l.lO.databaseName,g={FILE_MAPPING:"".concat(u,"_file_mapping"),OFFLINE_SETTINGS:"".concat(u,"_offline_settings"),DATA_PREFIX:"".concat(u,"_data_")};function _(){return o.Ii.isNativePlatform()}function f(){return{downloadAllAtStartup:l.hv.downloadAllAtStartup,downloadOnWifiOnly:l.hv.downloadOnWifiOnly,downloadQuality:l.hv.downloadQuality,maxConcurrentDownloads:l.hv.maxConcurrentDownloads,autoCleanupAfterDays:l.hv.autoCleanupAfterDays}}let p=null,E=null;function m(){p=null,E=null}async function v(){return null!==p?p:E||(E=(async()=>{try{let{value:e}=await i.p.get({key:g.FILE_MAPPING});return p=e?JSON.parse(e):null,E=null,p}catch(e){return E=null,null}})())}async function I(e){await i.p.set({key:g.FILE_MAPPING,value:JSON.stringify(e)}),p=e}async function R(){try{let{value:e}=await i.p.get({key:g.OFFLINE_SETTINGS});return e?JSON.parse(e):f()}catch(e){return f()}}async function A(e,t){let a="".concat(g.DATA_PREFIX).concat(e);await i.p.set({key:a,value:JSON.stringify(t)})}async function y(e){try{let t="".concat(g.DATA_PREFIX).concat(e),{value:a}=await i.p.get({key:t});return a?JSON.parse(a):null}catch(e){return null}}async function O(e){let t="".concat(g.DATA_PREFIX).concat(e);await i.p.remove({key:t})}async function h(e,t,a){var o,n;let i=w(e);s.vF.info("[offlineStorageService] downloadFile called",{fileId:i,remoteUrl:e.substring(e.lastIndexOf("/")),fileType:t,isNative:_()});let l=await v();if((null==l||null==(o=l.files[i])?void 0:o.status)==="completed")return s.vF.info("[offlineStorageService] File already downloaded",{fileId:i}),l.files[i];let u={id:i,remoteUrl:e,status:"downloading",progress:0,totalBytes:0,downloadedBytes:0};null==a||a(u);try{let o=await fetch(e);if(!o.ok)throw Error("Failed to download: ".concat(o.status," ").concat(o.statusText));let l=await o.blob(),g=await (n=l,new Promise((e,t)=>{let a=new FileReader;a.onloadend=()=>{e(a.result.split(",")[1])},a.onerror=t,a.readAsDataURL(n)})),f="".concat(d.FILES,"/").concat(t,"/").concat(i,".").concat("image"===t?"jpg":"mp3"),p={id:i,remoteUrl:e,localPath:f,fileType:t,fileSize:l.size,status:"completed",downloadedAt:new Date().toISOString(),lastAccessedAt:new Date().toISOString()};if(_())s.vF.info("[offlineStorageService] Writing file to Capacitor Filesystem",{fileId:i,filePath:f,blobSize:l.size,directory:"Directory.Data"}),await r.YA.writeFile({path:f,data:g,directory:r.__.Data,recursive:!0}),s.vF.info("[offlineStorageService] File written successfully",{fileId:i,filePath:f});else{let e="application/octet-stream";"image"===t?e="image/jpeg":"audio"===t?e="audio/mpeg":"3d-model"===t?e="model/gltf-binary":"video"===t&&(e="video/mp4"),await c.OJ(i,l,e)}return await F(p),u.status="completed",u.progress=100,u.totalBytes=l.size,u.downloadedBytes=l.size,null==a||a(u),p}catch(r){s.vF.error("Failed to download file",{error:r instanceof Error?r.message:String(r),fileId:i,remoteUrl:e});let t={id:i,remoteUrl:e,status:"failed",progress:0,totalBytes:0,downloadedBytes:0,error:r instanceof Error?r.message:"Unknown error"};throw null==a||a(t),r}}async function T(e,t){s.vF.info("[offlineStorageService] downloadFiles called",{totalUrls:e.length,isNative:_()});let{maxConcurrentDownloads:a}=await R();s.vF.info("[offlineStorageService] Download settings",{maxConcurrentDownloads:a,totalChunks:Math.ceil(e.length/a)});let r=function(e,t){let a=[];for(let r=0;r<e.length;r+=t)a.push(e.slice(r,r+t));return a}(e,a),o=[];for(let e of r){let a=e.map(e=>{let{url:a,fileType:r}=e;return h(a,r,t)});for(let e of(await Promise.allSettled(a)))"fulfilled"===e.status&&o.push(e.value)}return o}async function S(){try{s.vF.info("[offlineStorageService] Clearing all local files");let e=await v();if(e&&Object.keys(e.files).length>0){let t=Object.keys(e.files);if(s.vF.info("[offlineStorageService] Files to delete",{count:t.length}),_())for(let a of t){let t=e.files[a];try{await r.YA.deleteFile({path:t.localPath,directory:r.__.Data})}catch(e){s.vF.warn("[offlineStorageService] Failed to delete file",{fileId:a,error:e})}}else await c.$H()}await i.p.remove({key:g.FILE_MAPPING}),s.vF.info("[offlineStorageService] All local files cleared")}catch(e){throw s.vF.error("[offlineStorageService] Failed to clear all local files",{error:e instanceof Error?e.message:String(e)}),e}}let M=Promise.resolve();async function F(e){M=M.then(async()=>{try{let t=await v();t?(t.files[e.id]=e,t.lastUpdated=new Date().toISOString(),await I(t),s.vF.debug("[offlineStorageService] Updated file mapping: fileId=".concat(e.id,", total files=").concat(Object.keys(t.files).length))):(await I({version:"1.0.0",lastUpdated:new Date().toISOString(),files:{[e.id]:e}}),s.vF.debug("[offlineStorageService] Created new file mapping with fileId=".concat(e.id)))}catch(t){s.vF.error("[offlineStorageService] Failed to update file record: fileId=".concat(e.id),{error:t instanceof Error?t.message:String(t)})}}),await M}function w(e){let t=0;for(let a=0;a<e.length;a++)t=(t<<5)-t+e.charCodeAt(a),t&=t;return"file_".concat(Math.abs(t).toString(36))}async function D(e){try{var t;let a=w(e),o=await v(),n=e.substring(e.lastIndexOf("/")+1),i=!!(null==o?void 0:o.files[a]),l=null==o||null==(t=o.files[a])?void 0:t.status;if(s.vF.info("[offlineStorageService] getLocalFileByUrl: fileId=".concat(a,", file=").concat(n,", found=").concat(i,", status=").concat(l||"N/A")),!(null==o?void 0:o.files[a])||"completed"!==o.files[a].status){let e=Object.keys((null==o?void 0:o.files)||{}).slice(0,10).join(", ");return s.vF.warn("[offlineStorageService] File not found: fileId=".concat(a,", stored fileIds (first 10): ").concat(e)),null}if(_()){let e=o.files[a],t=await r.YA.readFile({path:e.localPath,directory:r.__.Data});e.lastAccessedAt=new Date().toISOString(),await F(e);let n="application/octet-stream";return"image"===e.fileType?n="image/jpeg":"audio"===e.fileType?n="audio/mpeg":"3d-model"===e.fileType?n="model/gltf-binary":"video"===e.fileType&&(n="video/mp4"),"data:".concat(n,";base64,").concat(t.data)}{let e=await c.Ac(a);if(e){let e=o.files[a];e.lastAccessedAt=new Date().toISOString(),await F(e)}return e}}catch(t){return s.vF.error("Failed to get local file by URL",{error:t instanceof Error?t.message:String(t),remoteUrl:e}),null}}async function N(e){try{let t=w(e),a=await v();if(!(null==a?void 0:a.files[t])||"completed"!==a.files[t].status)return null;if(_()){let e=a.files[t],o=await r.YA.readFile({path:e.localPath,directory:r.__.Data});e.lastAccessedAt=new Date().toISOString(),await F(e);let n=atob(o.data),i=new Uint8Array(n.length);for(let e=0;e<n.length;e++)i[e]=n.charCodeAt(e);let s="application/octet-stream";"3d-model"===e.fileType?s="model/gltf-binary":"image"===e.fileType?s="image/jpeg":"audio"===e.fileType&&(s="audio/mpeg");let l=new Blob([i],{type:s});return URL.createObjectURL(l)}{let e=await c.ly(t);if(e){let r=a.files[t];return r.lastAccessedAt=new Date().toISOString(),await F(r),URL.createObjectURL(e)}return null}}catch(t){return s.vF.error("Failed to get local file Blob URL",{error:t instanceof Error?t.message:String(t),remoteUrl:e}),null}}async function L(){try{if(_()){let e=await n.l.getStatus(),t="unknown";return e.connected?"wifi"===e.connectionType?t="wifi":"cellular"===e.connectionType&&(t="cellular"):t="none",{connected:e.connected,connectionType:t}}{let e=navigator.onLine;if(!e)return{connected:!1,connectionType:"none"};let t="wifi",a=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(a){let e=a.type||a.effectiveType;("cellular"===e||"4g"===e||"3g"===e||"2g"===e)&&(t="cellular")}return s.vF.debug("[Network] Web environment network check",{online:e,connectionType:t,hasConnectionAPI:!!a}),{connected:!0,connectionType:t}}}catch(e){return s.vF.error("Failed to check network type",{error:e instanceof Error?e.message:String(e)}),{connected:!0,connectionType:"wifi"}}}async function b(){try{if(_())return s.vF.warn("Storage space check not fully supported on native platform"),null;if("storage"in navigator&&"estimate"in navigator.storage){let e=await navigator.storage.estimate(),t=e.quota||0,a=e.usage||0;return{available:t-a,total:t,used:a,usedPercentage:t>0?a/t*100:0}}return null}catch(e){return s.vF.error("Failed to check storage space",{error:e instanceof Error?e.message:String(e)}),null}}async function k(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=await b();return a?a.available>=e*(1+t/100):null}},26945:(e,t,a)=>{"use strict";a.d(t,{Sn:()=>s,yL:()=>l});var r=a(91765);let o="/mocks",n="v1.0";function i(e){let t=new URLSearchParams;Object.entries(e).forEach(e=>{let[a,r]=e;null!=r&&(Array.isArray(r)?r.forEach(e=>t.append(a,String(e))):t.set(a,String(r)))});let a=t.toString();return a?"?".concat(a):""}let s={OVERVIEW:e=>"/".concat(n,"/goTour/overview").concat(i(e)),HOME:e=>"/".concat(n,"/goTour/overview").concat(i(e)),EXHIBITION_DETAIL:(e,t)=>"/".concat(n,"/goTour/exhibition/").concat(e).concat(i(t)),THEME_DETAIL:(e,t)=>"/".concat(n,"/goTour/theme/").concat(e).concat(i(t)),TOUR_DETAIL:(e,t)=>"/".concat(n,"/goTour/theme/").concat(e).concat(i(t)),WORK_DETAIL:(e,t)=>"/".concat(n,"/goTour/work/").concat(e).concat(i(t)),EXHIBITION_BY_BEACON:(e,t)=>"/".concat(n,"/goTour/exhibition/beacon/").concat(e).concat(i(t)),CURRENT_EXHIBITIONS:e=>"/".concat(n,"/goTour/exhibition/current").concat(i(e)),WORK_SEARCH:(e,t)=>"/".concat(n,"/goTour/work/search/").concat(e).concat(i(t)),VENUE_INFO:(e,t)=>"/".concat(n,"/goTour/venue/").concat(e).concat(i(t)),VENUE_MAP:e=>"/".concat(n,"/goTour/venue/map").concat(i(e)),SYSTEM_INFO:e=>"/".concat(n,"/goTour/systemInfo").concat(i(e||{})),PACKAGE_CHECK_UPDATE:e=>"/".concat(n,"/goTour/package/checkUpdate").concat(i(e)),PACKAGE_INFO:e=>"/".concat(n,"/goTour/package").concat(i(e))};function l(e,t,a){let n=new URLSearchParams(e.split("?")[1]||""),i=t||n.get("lang")||"zh-TW",s=a||n.get("content_type")||"adult",l=e.split("?")[0];if(l.includes("/systemInfo"))return"".concat(o,"/system_info.json");if(l.includes("/package/checkUpdate"))return"".concat(o,"/package_check_update.json");if(l.includes("/package")&&!l.includes("/checkUpdate"))return"".concat(o,"/package_info.json");if(l.includes("/overview"))return"".concat(o,"/overview/").concat(s,"/").concat(i,".json");if(l.includes("/exhibition/")){let e=l.match(/\/exhibition\/([^/?]+)/),t=e?e[1]:"";return"".concat(o,"/exhibitions/").concat(t,"/").concat(s,"/").concat(i,".json")}if(l.includes("/theme/")){let e=l.match(/\/theme\/([^/?]+)/),t=e?e[1]:"";return"".concat(o,"/themes/").concat(t,"/").concat(s,"/").concat(i,".json")}if(l.includes("/work/")){let e=l.match(/\/work\/([^/?]+)/),t=e?e[1]:"";return"".concat(o,"/works/").concat(t,"/").concat(s,"/").concat(i,".json")}if(l.includes("/venue/map"))return"".concat(o,"/venue/map/").concat(i,".json");if(l.includes("/exhibition/current"))return"".concat(o,"/exhibitions/current/").concat(s,"/").concat(i,".json");if(l.includes("/venue/")&&!l.includes("/search")&&!l.includes("/map")){let e=l.match(/\/venue\/([^/?]+)/),t=e?e[1]:"";return"".concat(o,"/venue/").concat(t,"/").concat(s,"/").concat(i,".json")}return r.vF.warn("No mock URL mapping for endpoint: ".concat(e)),"".concat(o).concat(l,"/").concat(s,"/").concat(i,".json")}},28496:(e,t,a)=>{"use strict";a.d(t,{EW:()=>s,KW:()=>i,hv:()=>o,lO:()=>n});var r=a(13588);let o={downloadAllAtStartup:!1,autoDownloadNewContent:!1,downloadOnWifiOnly:!0,downloadQuality:"high",maxConcurrentDownloads:3,maxRetries:3,retryDelay:3e3,downloadTimeout:6e4,autoCleanupAfterDays:30,keepHistoryForDays:90},n={maxStorageUsage:0,storageWarningThreshold:.8,storageFullThreshold:.95,databaseName:"artogo-audio-guide",databaseVersion:1},i={uuid:"00000000-0000-0000-0000-000000000000",scanInterval:3e3,rssiThreshold:-75,proximityTriggerDistance:3,signalTimeout:1e4},s={defaultTheme:"dark",tabBarHeight:50,miniPlayerHeight:64,floatingBubbleSize:56,pageTransitionDuration:300,toastDuration:3e3,listPageSize:20,infiniteScrollThreshold:100};r.Fc,r.G2,r.Nm,r.MB,r.v4,r.uv},33252:(e,t,a)=>{"use strict";a.d(t,{S8:()=>p,Xo:()=>S,_x:()=>M,clearLocalPackage:()=>A,cy:()=>I,y$:()=>m});var r=a(97290),o=a(26945),n=a(91765),i=a(22430),s=a(85110),l=a(28496),c=a(40696),d=a(54798),u=a(67581);let g=l.lO.databaseName,_={PACKAGE_DATA:"".concat(g,"_package_data"),PACKAGE_INFO:"".concat(g,"_package_info")};function f(){return c.Ii.isNativePlatform()}async function p(e,t){let a,i=o.Sn.PACKAGE_CHECK_UPDATE({venue_uid:e,version:String(t)});r.$W.features.mockData?(a=(0,o.yL)(i),n.vF.debug("[PackageService] Using mock data for checkUpdate",{venueUid:e,currentVersion:t,mockUrl:a})):a=new URL(i,r.$W.apiUrl||"http://localhost:3020/api").toString();let s=await fetch(a);if(!s.ok)throw Error("Failed to check package update: ".concat(s.statusText));let l=await s.json();return l.success&&l.data?l.data:l}async function E(e,t){let a,i=o.Sn.PACKAGE_INFO({venue_uid:e,version:t});r.$W.features.mockData?(a=(0,o.yL)(i),n.vF.info("[PackageService] Using mock data for package",{venueUid:e,version:t,mockUrl:a})):(a=new URL(i,r.$W.apiUrl||"http://localhost:3020/api").toString(),n.vF.info("[PackageService] Fetching package from API",{venueUid:e,version:t}));let s=await fetch(a);if(!s.ok)throw Error("Failed to fetch package: ".concat(s.statusText));let l=await s.json();return l.success&&l.data?l.data:l}async function m(){try{if(f()){let{value:e}=await d.p.get({key:_.PACKAGE_INFO});return e?JSON.parse(e):null}{let e=localStorage.getItem(_.PACKAGE_INFO);return e?JSON.parse(e):null}}catch(e){return null}}async function v(e){f()?await d.p.set({key:_.PACKAGE_INFO,value:JSON.stringify(e)}):localStorage.setItem(_.PACKAGE_INFO,JSON.stringify(e))}async function I(){try{let e=f();if(n.vF.debug("[PackageService] getLocalPackageData called",{isNativePlatform:e,storageKey:_.PACKAGE_DATA}),e){let{value:e}=await d.p.get({key:_.PACKAGE_DATA});return n.vF.debug("[PackageService] Native getLocalPackageData result",{hasValue:!!e,valueLength:null==e?void 0:e.length}),e?JSON.parse(e):null}{let e=await u.bQ(_.PACKAGE_DATA);return n.vF.debug("[PackageService] Web getLocalPackageData result",{hasData:!!e,hasSystem:!!(null==e?void 0:e.system),hasInfo:!!(null==e?void 0:e.info)}),e}}catch(e){return n.vF.error("[PackageService] Failed to get package data",{error:e}),null}}async function R(e){let t=f();n.vF.info("[PackageService] saveLocalPackageData called",{isNativePlatform:t,storageKey:_.PACKAGE_DATA,hasSystem:!!(null==e?void 0:e.system),hasInfo:!!(null==e?void 0:e.info),infoKeys:(null==e?void 0:e.info)?Object.keys(e.info):[]}),t?(await d.p.set({key:_.PACKAGE_DATA,value:JSON.stringify(e)}),n.vF.info("[PackageService] Native saveLocalPackageData completed")):(await u.iu(_.PACKAGE_DATA,e),n.vF.info("[PackageService] Web saveLocalPackageData completed (IndexedDB)"))}async function A(){n.vF.info("[PackageService] Clearing local package",{isNativePlatform:f()}),f()?(await d.p.remove({key:_.PACKAGE_INFO}),await d.p.remove({key:_.PACKAGE_DATA}),n.vF.info("[PackageService] Native package data cleared via Preferences")):(localStorage.removeItem(_.PACKAGE_INFO),await u.Wv(_.PACKAGE_DATA),n.vF.info("[PackageService] Web package data cleared via localStorage + IndexedDB")),await (0,i.lr)(),await (0,s.pw)(),await (0,s.EA)();let{clearFileMappingCache:e}=await Promise.resolve().then(a.bind(a,22430));e();let{clearResolvedImageCache:t,clearOfflineModeCache:r}=await Promise.resolve().then(a.bind(a,3226));t(),r(),n.vF.info("[PackageService] Local package cleared completely (including memory caches)")}function y(e,t,a){var r,o,n,i;null==(r=e.medias)||r.forEach(e=>{a(e,"image")}),null==(o=e.media_audio_guidances)||o.forEach(e=>{var a;null==(a=e.audio_files)||a.forEach(e=>{t(e.url,"audio")})}),null==(n=e.media_audio_descriptions)||n.forEach(e=>{var a;null==(a=e.audio_files)||a.forEach(e=>{t(e.url,"audio")})}),null==(i=e.media_sign_language_guidances)||i.forEach(e=>{var a;null==(a=e.video_files)||a.forEach(e=>{t(e.url,"audio")})}),e.model_3ds&&e.model_3ds.length>0&&e.model_3ds.forEach(e=>{var a;null==(a=e.model_files)||a.forEach(e=>{t(e.url,"3d-model")})})}async function O(e){try{if(c.Ii.isNativePlatform()){let t=await fetch(e,{method:"GET",headers:{Range:"bytes=0-0"}});if(t.ok||206===t.status){let e=t.headers.get("content-range");if(e){let t=e.match(/\/(\d+)$/);if(t)return parseInt(t[1],10)}let a=t.headers.get("content-length");if(a){let e=parseInt(a,10);if(e>1)return e}}return 0}let t=await fetch(e,{method:"HEAD"});if(t.ok){let e=t.headers.get("content-length");return e?parseInt(e,10):0}return 0}catch(e){return 0}}async function h(e,t){let a=new Map,r=[],o=0;for(let n=0;n<e.length;n+=10){let i=e.slice(n,n+10);for(let{url:e,size:t}of(await Promise.all(i.map(async e=>{let{url:t}=e,a=await O(t);return{url:t,size:a}}))))t>0?(a.set(e,t),o+=t):r.push(e);null==t||t(Math.min(n+10,e.length),e.length)}return{totalSize:o,fileSizes:a,failedUrls:r}}async function T(e){let t=await (0,i.checkNetworkType)();if(!t.connected)return{canDownload:!1,reason:"no_network",networkType:"none"};if(!1===await (0,i.QW)(e))return{canDownload:!1,reason:"insufficient_storage",networkType:t.connectionType};let a="wifi"===t.connectionType;return{canDownload:!0,networkType:t.connectionType,needsConfirmation:!a,confirmationReason:a?void 0:"not_wifi"}}async function S(e,t,a){try{let r=0,o=e=>{if(!a)return;let t=Date.now();if("completed"===e.status||"failed"===e.status)return void a(e);t-r>=500&&(r=t,a(e))};null==a||a({status:"downloading_json",totalFiles:0,completedFiles:0,overallProgress:0}),n.vF.info("[PackageService] Starting package download",{venueUid:e,version:t});let s=await E(e,t),l=function(e){let t=[],a=new Set,r=(e,r)=>{!(!e||a.has(e))&&(e.startsWith("http://")||e.startsWith("https://"))&&e.startsWith("https://media.artogo")&&(a.add(e),t.push({url:e,fileType:r}))},o=(e,t)=>{r(function(e){if(!e||!e.info||0===e.info.length)return;let t=e.info[0];return t.media_sources&&t.media_sources.length>0?t.media_sources[0].url:t.value}(e),t)};return e.system&&o(e.system.img_key_vision,"image"),e.info&&Object.values(e.info).forEach(e=>{o(e.img_key_vision,"image"),Array.isArray(e.overview)&&e.overview.forEach(e=>{var t;null==(t=e.media_files)||t.forEach(e=>{r(e.url,"image")})})}),e.overview&&Object.values(e.overview).forEach(e=>{Object.values(e).forEach(e=>{var t,a,r,n;o(null==(t=e.venue)?void 0:t.img_key_vision,"image"),null==(a=e.exhibitions)||a.forEach(e=>{o(e.img_key_vision,"image")}),null==(r=e.themes)||r.forEach(e=>{o(e.img_key_vision,"image")}),null==(n=e.works)||n.forEach(e=>{o(e.img_key_vision,"image")})})}),e.exhibitions&&Object.values(e.exhibitions).forEach(e=>{Object.values(e).forEach(e=>{e.forEach(e=>{var t,a;o(e.img_key_vision,"image"),null==(t=e.medias)||t.forEach(e=>{o(e,"image")}),null==(a=e.works)||a.forEach(e=>{y(e,r,o)})})})}),e.themes&&Object.values(e.themes).forEach(e=>{Object.values(e).forEach(e=>{e.forEach(e=>{var t,a;o(e.img_key_vision,"image"),null==(t=e.medias)||t.forEach(e=>{o(e,"image")}),null==(a=e.works)||a.forEach(e=>{y(e,r,o)})})})}),e.works&&Object.values(e.works).forEach(e=>{Object.values(e).forEach(e=>{e.forEach(e=>{y(e,r,o)})})}),e.areas&&e.areas.forEach(e=>{o(e.img_map,"image")}),t}(s),c=l.length;n.vF.info("[PackageService] Extracted media URLs",{totalFiles:c}),o({status:"downloading_json",totalFiles:c,completedFiles:0,overallProgress:2});let d=0,u=0,g=0,_=await T(0);if(!_.canDownload)return{success:!1,error:_.reason};if(0===c)n.vF.info("[PackageService] No media files to download"),o({status:"downloading_files",totalFiles:0,completedFiles:0,overallProgress:90});else{let e=await h(l,(e,t)=>{o({status:"downloading_json",totalFiles:c,completedFiles:0,overallProgress:2+e/t*3})});d=e.totalSize,n.vF.info("[PackageService] Calculated total media size",{totalSize:d,totalSizeMB:(d/1024/1024).toFixed(2),failedUrls:e.failedUrls.length});let t=await T(d);if(!t.canDownload)return{success:!1,error:t.reason};o({status:"downloading_files",totalFiles:c,completedFiles:0,overallProgress:5,totalSize:d,downloadedSize:0}),n.vF.info("[PackageService] Starting media files download",{totalFiles:c,totalUrls:l.length});let a=await (0,i.Si)(l,e=>{if("completed"===e.status){u++,g+=e.totalBytes||0;let t=5+u/c*95;o({status:"downloading_files",totalFiles:c,completedFiles:u,currentFile:e.remoteUrl,overallProgress:t,totalSize:d,downloadedSize:g})}});n.vF.info("[PackageService] Media files download completed",{totalFiles:c,completedFiles:u,downloadedResults:a.length});let r=c-a.length;if(r>0)return n.vF.error("[PackageService] Some file downloads failed",{totalFiles:c,successCount:a.length,failedCount:r}),{success:!1,error:"download_failed: ".concat(r," of ").concat(c," files failed")}}await R(s);let f=parseInt(t,10)||0,p={status:"downloaded",version:f,venueUid:e,downloadedAt:new Date().toISOString(),lastUpdatedAt:new Date().toISOString(),totalFiles:c,downloadedFiles:u,totalSize:d,downloadedSize:g};return await v(p),null==a||a({status:"completed",totalFiles:c,completedFiles:c,overallProgress:100}),n.vF.info("[PackageService] Package download completed",{venueUid:e,version:t,totalFiles:c,completedFiles:u}),{success:!0}}catch(r){let e=r instanceof Error?r.message:String(r);n.vF.error("[PackageService] Package download failed",{error:e});let t=await m();return t&&(t.status="error",t.errorMessage=e,await v(t)),null==a||a({status:"failed",totalFiles:0,completedFiles:0,overallProgress:0,error:e}),{success:!1,error:e}}}async function M(){let e=await m();return null!==e&&"not_downloaded"!==e.status}},35030:(e,t,a)=>{"use strict";a.d(t,{a:()=>l,b:()=>s});var r=a(81556),o=a(42836),n=a(65856),i=a.n(n);function s(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:24,n=n=>{let{className:s="",size:l=a,color:c="gray",alt:d}=n,u=e.startsWith("/")?e:"/icons/".concat(c,"/").concat(e,".svg");return(0,r.jsx)("div",{className:"".concat(i().iconContainer," ").concat(s),style:{width:l,height:l},children:(0,r.jsx)(o.default,{src:u,alt:void 0!==d?d:t,fill:!0,style:{objectFit:"contain"}})})};return n.displayName="Icon(".concat(e,")"),n}function l(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:24;return{Filled:s("".concat(e,"/filled"),"".concat(t," (實心)"),a),Outline:s("".concat(e,"/outline"),"".concat(t," (輪廓)"),a)}}},52728:(e,t,a)=>{"use strict";a.d(t,{A0:()=>K,AW:()=>M,CC:()=>w,Dq:()=>P,F6:()=>v,GG:()=>T,Gt:()=>b,Ho:()=>L,IO:()=>G,Io:()=>S,L5:()=>D,Lw:()=>x,Oe:()=>n,Om:()=>O,S7:()=>s,Ts:()=>V,Tv:()=>u,UG:()=>C,Vg:()=>m,Wq:()=>H,Xm:()=>k,YY:()=>j,_Z:()=>i,as:()=>R,cf:()=>A,dE:()=>B,gz:()=>o,hb:()=>g,iG:()=>W,iW:()=>E,j5:()=>p,jb:()=>F,kT:()=>h,oW:()=>l,r3:()=>_,rm:()=>U,s$:()=>d,sq:()=>c,t9:()=>f,y1:()=>N,yF:()=>y,yr:()=>I,z5:()=>z});var r=a(35030);let o=(0,r.b)("close","關閉");(0,r.b)("close_small","關閉（小）");let n=(0,r.b)("hide","隱藏");(0,r.b)("more","更多");let i=(0,r.b)("pause","暫停"),s=(0,r.b)("pause_circle","暫停（圓形）"),l=(0,r.b)("skip_next_filled","下一個"),c=(0,r.b)("skip_previous_filled","上一個"),d=(0,r.b)("backward-15-seconds","後退 15 秒"),u=(0,r.b)("forward-15-seconds","前進 15 秒"),g=(0,r.b)("volume_up","音量增加"),_=(0,r.b)("volume_down_alt","音量減少"),f=(0,r.b)("speed","播放速度"),p=(0,r.b)("subtitles","字幕");(0,r.b)("info","資訊");let E=(0,r.b)("check","確認");(0,r.b)("add","新增"),(0,r.b)("add_2","新增2"),(0,r.b)("remove","移除"),(0,r.b)("check_indeterminate_small","不確定狀態"),(0,r.b)("search","搜尋");let m=(0,r.b)("search_off","關閉搜尋");(0,r.b)("zoom_in","放大");let v=(0,r.b)("3d_rotation","3D 旋轉"),I=(0,r.b)("touch_double","雙擊"),R=(0,r.b)("pinch","捏合"),A=(0,r.b)("pan_tool_alt","平移工具"),y=(0,r.b)("pin_drop","位置標記"),O=(0,r.b)("explore_nearby","探索附近");(0,r.b)("library_books","圖書館"),(0,r.b)("expand_content","展開內容"),(0,r.b)("language","語言"),(0,r.b)("accessibility","無障礙"),(0,r.b)("calendar_today","日曆");let h=(0,r.b)("confirmation_number","票券"),T=(0,r.b)("call","通話"),S=(0,r.b)("admin_panel_settings","管理員設定");(0,r.b)("brand_awareness","品牌認知"),(0,r.b)("energy_program_time_used","能源使用時間"),(0,r.b)("custom_typography","自訂字型"),(0,r.b)("text_fields","文字欄位"),(0,r.b)("backspace","退格");let M=(0,r.b)("graphic_eq","等化器");(0,r.b)("hearing","聽力"),(0,r.b)("sign_language","手語"),(0,r.b)("supervisor_account","監督者帳號");let F=(0,r.a)("person","人員");(0,r.a)("account_circle","帳號");let w=(0,r.a)("favorite","最愛");(0,r.a)("star_rate","評分");let D=(0,r.a)("stars","星星"),N=(0,r.a)("location_on","位置"),L=(0,r.a)("home","首頁"),b=(0,r.a)("map","地圖"),k=(0,r.a)("room","房間");(0,r.a)("add_location","新增位置"),(0,r.a)("settings","設定");let C=(0,r.a)("play_circle","播放"),P=(0,r.a)("play_arrow","播放箭頭"),U=(0,r.a)("headphones","耳機"),K=(0,r.a)("arrow_forward","前進"),W=(0,r.a)("arrow_back","返回"),G=(0,r.a)("keyboard_arrow_down","向下箭頭");(0,r.a)("expand_circle_down","展開");let x=(0,r.a)("help","說明"),B=(0,r.a)("schedule","時程"),V=(0,r.a)("dialpad","撥號鍵盤"),j=(0,r.a)("article","文章"),H=(0,r.a)("event_list","活動列表");(0,r.a)("support_agent","客服");let z=(0,r.a)("theme","主題")},65856:e=>{e.exports={iconContainer:"Icon_iconContainer__mTv1j",iconContainerMore:"Icon_iconContainerMore__LqWMU",iconWrapper:"Icon_iconWrapper__bxwPj"}},67581:(e,t,a)=>{"use strict";a.d(t,{$H:()=>f,Ac:()=>_,OJ:()=>u,Wv:()=>d,bQ:()=>c,iu:()=>l,ly:()=>g});var r=a(91765);let o=a(28496).lO.databaseName,n={DATA:"data",FILES:"files"},i=null;async function s(){return i||new Promise((e,t)=>{if(!("indexedDB"in window&&null!==window.indexedDB))return void t(Error("IndexedDB is not available"));let a=indexedDB.open(o,1);a.onerror=()=>{var e;r.vF.error("[IndexedDB] Failed to open database",{error:null==(e=a.error)?void 0:e.message}),t(a.error)},a.onsuccess=()=>{i=a.result,r.vF.debug("[IndexedDB] Database opened successfully",{dbName:o}),e(a.result)},a.onupgradeneeded=e=>{let t=e.target.result;t.objectStoreNames.contains(n.DATA)||(t.createObjectStore(n.DATA,{keyPath:"key"}),r.vF.debug("[IndexedDB] Created data store")),t.objectStoreNames.contains(n.FILES)||(t.createObjectStore(n.FILES,{keyPath:"key"}),r.vF.debug("[IndexedDB] Created files store"))}})}async function l(e,t){let a=await s();return new Promise((o,i)=>{let s=a.transaction(n.DATA,"readwrite").objectStore(n.DATA),l={key:e,data:t,timestamp:Date.now()},c=s.put(l);c.onerror=()=>{var t;r.vF.error("[IndexedDB] Failed to save data",{key:e,error:null==(t=c.error)?void 0:t.message}),i(c.error)},c.onsuccess=()=>{r.vF.debug("[IndexedDB] Data saved",{key:e}),o()}})}async function c(e){let t=await s();return new Promise((a,o)=>{let i=t.transaction(n.DATA,"readonly").objectStore(n.DATA).get(e);i.onerror=()=>{var t;r.vF.error("[IndexedDB] Failed to get data",{key:e,error:null==(t=i.error)?void 0:t.message}),o(i.error)},i.onsuccess=()=>{let t=i.result;t?(r.vF.debug("[IndexedDB] Data retrieved",{key:e}),a(t.data)):a(null)}})}async function d(e){let t=await s();return new Promise((a,o)=>{let i=t.transaction(n.DATA,"readwrite").objectStore(n.DATA).delete(e);i.onerror=()=>{var t;r.vF.error("[IndexedDB] Failed to delete data",{key:e,error:null==(t=i.error)?void 0:t.message}),o(i.error)},i.onsuccess=()=>{r.vF.debug("[IndexedDB] Data deleted",{key:e}),a()}})}async function u(e,t,a){let o=await s();return new Promise((i,s)=>{let l=o.transaction(n.FILES,"readwrite").objectStore(n.FILES),c={key:e,blob:t,mimeType:a,size:t.size,timestamp:Date.now()},d=l.put(c);d.onerror=()=>{var a;r.vF.error("[IndexedDB] Failed to save file",{key:e,size:t.size,error:null==(a=d.error)?void 0:a.message}),s(d.error)},d.onsuccess=()=>{r.vF.debug("[IndexedDB] File saved",{key:e,size:t.size,mimeType:a}),i()}})}async function g(e){let t=await s();return new Promise((a,o)=>{let i=t.transaction(n.FILES,"readonly").objectStore(n.FILES).get(e);i.onerror=()=>{var t;r.vF.error("[IndexedDB] Failed to get file",{key:e,error:null==(t=i.error)?void 0:t.message}),o(i.error)},i.onsuccess=()=>{let t=i.result;t?(r.vF.debug("[IndexedDB] File retrieved",{key:e,size:t.size,mimeType:t.mimeType}),a(t.blob)):a(null)}})}async function _(e){let t=await g(e);return t?new Promise((e,a)=>{let r=new FileReader;r.onloadend=()=>e(r.result),r.onerror=()=>a(r.error),r.readAsDataURL(t)}):null}async function f(){let e=await s();return new Promise((t,a)=>{let o=e.transaction([n.DATA,n.FILES],"readwrite");o.onerror=()=>{var e;r.vF.error("[IndexedDB] Failed to clear all data",{error:null==(e=o.error)?void 0:e.message}),a(o.error)},o.oncomplete=()=>{r.vF.info("[IndexedDB] All data cleared"),t()},o.objectStore(n.DATA).clear(),o.objectStore(n.FILES).clear()})}},82305:(e,t,a)=>{"use strict";a.d(t,{IB:()=>r,L$:()=>n,q:()=>o});let r=["zh-TW","zh-Hant-TW-Tailo","hak","yue","en","ja","ko","fr","es","de","th","id","vi"],o="zh-TW",n={"zh-TW":"繁體中文","zh-Hant-TW-Tailo":"台語",hak:"客語",yue:"粵語",en:"English",ja:"日本語",ko:"한국어",fr:"Fran\xe7ais",es:"Espa\xf1ol",de:"Deutsch",th:"ไทย",id:"Bahasa Indonesia",vi:"Tiếng Việt"}},83576:(e,t,a)=>{"use strict";a.d(t,{El:()=>l});let r="__INIT_GUARD__",o="__INIT_CACHE__";function n(e){return"".concat(r).concat(e)}function i(e){return"".concat(o).concat(e)}function s(){return"undefined"!=typeof sessionStorage}let l={KEYS:{MONITORING:"monitoring",SETTINGS:"settings",PACKAGE_STATUS:"package_status",INITIAL_SETUP:"initial_setup",PLAYER_HISTORY:"player_history",THEME:"theme"},hasRun:function(e){return!!s()&&"true"===sessionStorage.getItem(n(e))},markAsRun:function(e){s()&&sessionStorage.setItem(n(e),"true")},getCachedValue:function(e){if(!s())return;let t=sessionStorage.getItem(i(e));if(null!==t)try{return JSON.parse(t)}catch(e){return}},setCachedValue:function(e,t){s()&&sessionStorage.setItem(i(e),JSON.stringify(t))},clearCachedValue:function(e){s()&&sessionStorage.removeItem(i(e))},reset:function(e){s()&&sessionStorage.removeItem(n(e))},resetAll:function(){if(!s())return;let e=[];for(let t=0;t<sessionStorage.length;t++){let a=sessionStorage.key(t);a&&(a.startsWith(r)||a.startsWith(o))&&e.push(a)}e.forEach(e=>sessionStorage.removeItem(e))}}},85110:(e,t,a)=>{"use strict";a.d(t,{A1:()=>f,BJ:()=>D,Bb:()=>T,Bi:()=>R,CW:()=>v,E0:()=>C,EA:()=>w,IO:()=>b,M7:()=>p,Mf:()=>g,O4:()=>P,Un:()=>d,dw:()=>F,hy:()=>U,j1:()=>E,k3:()=>L,mt:()=>y,pw:()=>k,qM:()=>O});var r=a(54798),o=a(7878),n=a(13588),i=a(28496),s=a(97290);let l=i.lO.databaseName,c={VERSION:"app_version",FONT_SIZE:"app_font_size",IS_ADMIN_MODE:"app_is_admin_mode",IS_OFFLINE_MODE:"app_is_offline_mode",PACKAGE_VERSION:"app_package_version",LAST_PACKAGE_UPDATE:"app_last_package_update",FAVORITES:"".concat(l,"_user_favorites"),PLAY_HISTORY:"".concat(l,"_user_play_history"),THEME:"artogo-theme"};async function d(e){await r.p.set({key:c.VERSION,value:e})}async function u(){let{value:e}=await r.p.get({key:c.VERSION});return e||n.uv}async function g(e){await r.p.set({key:c.FONT_SIZE,value:e})}async function _(){let{value:e}=await r.p.get({key:c.FONT_SIZE});return e||o.gI}async function f(e){await r.p.set({key:c.IS_ADMIN_MODE,value:String(e)})}async function p(e){await r.p.set({key:c.IS_OFFLINE_MODE,value:String(e)})}async function E(){let{value:e}=await r.p.get({key:c.IS_OFFLINE_MODE});return null!==e?"true"===e:s.$W.features.offlineMode}async function m(){let{value:e}=await r.p.get({key:c.IS_OFFLINE_MODE});if(null!==e)return"true"===e;let t=s.$W.features.offlineMode;return await p(t),t}async function v(e){await r.p.set({key:c.PACKAGE_VERSION,value:String(e)})}async function I(){let{value:e}=await r.p.get({key:c.PACKAGE_VERSION});return e?parseInt(e,10):void 0}async function R(e){await r.p.set({key:c.LAST_PACKAGE_UPDATE,value:e})}async function A(){let{value:e}=await r.p.get({key:c.LAST_PACKAGE_UPDATE});return e||void 0}async function y(){let[e,t,a,r,o]=await Promise.all([u(),_(),m(),I(),A()]);return{version:e,fontSize:t,isAdminMode:!1,isOfflineMode:a,packageVersion:r,lastPackageUpdate:o}}async function O(){let{value:e}=await r.p.get({key:c.FAVORITES});return e?JSON.parse(e).map(e=>({...e,favoritedAt:new Date(e.favoritedAt)})):[]}async function h(e){await r.p.set({key:c.FAVORITES,value:JSON.stringify(e)})}async function T(e){return(await O()).some(t=>t.workID===e)}async function S(e){let t=await O();t.some(t=>t.workID===e.workID)||(t.unshift({...e,favoritedAt:new Date}),await h(t))}async function M(e){let t=(await O()).filter(t=>t.workID!==e);await h(t)}async function F(e){let t="string"==typeof e?e:e.workID;if(await T(t))return await M(t),!1;if("string"==typeof e)throw Error("Cannot add favorite with workID only. Please provide complete work information.");return await S(e),!0}async function w(){await r.p.remove({key:c.FAVORITES})}async function D(){let{value:e}=await r.p.get({key:c.PLAY_HISTORY});return e?JSON.parse(e).map(e=>({...e,lastPlayedAt:new Date(e.lastPlayedAt)})):[]}async function N(e){await r.p.set({key:c.PLAY_HISTORY,value:JSON.stringify(e)})}async function L(e,t){let a=await D();return t?a.find(a=>a.workID===e&&a.contentID===t)||null:a.find(t=>t.workID===e)||null}async function b(e){let t=await D();(t=t.filter(t=>t.workID!==e.workID||t.contentID!==e.contentID)).unshift({...e,lastPlayedAt:new Date}),t.length>100&&(t=t.slice(0,100)),await N(t)}async function k(){await r.p.remove({key:c.PLAY_HISTORY})}async function C(){await Promise.all([w(),k()])}async function P(){let{value:e}=await r.p.get({key:c.THEME});return"light"===e||"dark"===e?e:"dark"}async function U(e){await r.p.set({key:c.THEME,value:e})}},85550:(e,t,a)=>{"use strict";a.d(t,{F4:()=>s,GB:()=>g,Gz:()=>u,Sc:()=>r,eo:()=>d,fN:()=>_,hg:()=>o,li:()=>c,mZ:()=>n,ou:()=>l,sc:()=>i});var r=function(e){return e.NO_CONNECTION="NETWORK_NO_CONNECTION",e.TIMEOUT="NETWORK_TIMEOUT",e.ABORTED="NETWORK_ABORTED",e.DNS_FAILED="NETWORK_DNS_FAILED",e.SSL_ERROR="NETWORK_SSL_ERROR",e.UNSTABLE="NETWORK_UNSTABLE",e}({}),o=function(e){return e.REQUIRED_FIELD_EMPTY="VALIDATION_REQUIRED_FIELD_EMPTY",e.INVALID_FORMAT="VALIDATION_INVALID_FORMAT",e.INVALID_EMAIL="VALIDATION_INVALID_EMAIL",e.INVALID_PHONE="VALIDATION_INVALID_PHONE",e.WEAK_PASSWORD="VALIDATION_WEAK_PASSWORD",e.PASSWORD_MISMATCH="VALIDATION_PASSWORD_MISMATCH",e.OUT_OF_RANGE="VALIDATION_OUT_OF_RANGE",e.INVALID_LENGTH="VALIDATION_INVALID_LENGTH",e.INVALID_DATE="VALIDATION_INVALID_DATE",e.INVALID_FILE_TYPE="VALIDATION_INVALID_FILE_TYPE",e.FILE_TOO_LARGE="VALIDATION_FILE_TOO_LARGE",e}({}),n=function(e){return e.RUNTIME_ERROR="RUNTIME_ERROR",e.OUT_OF_MEMORY="RUNTIME_OUT_OF_MEMORY",e.UNEXPECTED_ERROR="RUNTIME_UNEXPECTED_ERROR",e.INITIALIZATION_FAILED="RUNTIME_INITIALIZATION_FAILED",e.SERVICE_UNAVAILABLE="RUNTIME_SERVICE_UNAVAILABLE",e.FEATURE_NOT_SUPPORTED="RUNTIME_FEATURE_NOT_SUPPORTED",e}({}),i=function(e){return e.COMPONENT_RENDER_ERROR="UI_COMPONENT_RENDER_ERROR",e.DATA_LOAD_ERROR="UI_DATA_LOAD_ERROR",e.IMAGE_LOAD_ERROR="UI_IMAGE_LOAD_ERROR",e.VIDEO_PLAY_ERROR="UI_VIDEO_PLAY_ERROR",e.INTERACTION_TIMEOUT="UI_INTERACTION_TIMEOUT",e.INFINITE_LOOP_DETECTED="UI_INFINITE_LOOP_DETECTED",e}({}),s=function(e){return e.STORAGE_FULL="STORAGE_FULL",e.FILE_READ_ERROR="STORAGE_FILE_READ_ERROR",e.FILE_WRITE_ERROR="STORAGE_FILE_WRITE_ERROR",e.LOCALSTORAGE_ERROR="STORAGE_LOCALSTORAGE_ERROR",e.SESSIONSTORAGE_ERROR="STORAGE_SESSIONSTORAGE_ERROR",e.INDEXEDDB_ERROR="STORAGE_INDEXEDDB_ERROR",e.COOKIE_ERROR="STORAGE_COOKIE_ERROR",e.CACHE_ERROR="STORAGE_CACHE_ERROR",e}({}),l=function(e){return e.CAMERA_PERMISSION_DENIED="MEDIA_CAMERA_PERMISSION_DENIED",e.CAMERA_INIT_FAILED="MEDIA_CAMERA_INIT_FAILED",e.MICROPHONE_PERMISSION_DENIED="MEDIA_MICROPHONE_PERMISSION_DENIED",e.MICROPHONE_INIT_FAILED="MEDIA_MICROPHONE_INIT_FAILED",e.LOCATION_PERMISSION_DENIED="MEDIA_LOCATION_PERMISSION_DENIED",e.LOCATION_SERVICE_DISABLED="MEDIA_LOCATION_SERVICE_DISABLED",e.LOCATION_TIMEOUT="MEDIA_LOCATION_TIMEOUT",e.NOTIFICATION_PERMISSION_DENIED="MEDIA_NOTIFICATION_PERMISSION_DENIED",e}({}),c=function(e){return e.FIREBASE_INIT_ERROR="THIRD_PARTY_FIREBASE_INIT_ERROR",e.FIREBASE_ANALYTICS_ERROR="THIRD_PARTY_FIREBASE_ANALYTICS_ERROR",e.FIREBASE_CRASHLYTICS_ERROR="THIRD_PARTY_FIREBASE_CRASHLYTICS_ERROR",e.GOOGLE_MAPS_LOAD_ERROR="THIRD_PARTY_GOOGLE_MAPS_LOAD_ERROR",e.SOCIAL_LOGIN_ERROR="THIRD_PARTY_SOCIAL_LOGIN_ERROR",e.FACEBOOK_SDK_ERROR="THIRD_PARTY_FACEBOOK_SDK_ERROR",e.GOOGLE_SDK_ERROR="THIRD_PARTY_GOOGLE_SDK_ERROR",e.LINE_SDK_ERROR="THIRD_PARTY_LINE_SDK_ERROR",e}({}),d=function(e){return e.REQUEST_CONFIG_ERROR="HTTP_REQUEST_CONFIG_ERROR",e.REQUEST_CANCELLED="HTTP_REQUEST_CANCELLED",e.RESPONSE_PARSE_ERROR="HTTP_RESPONSE_PARSE_ERROR",e.CORS_ERROR="HTTP_CORS_ERROR",e.INTERCEPTOR_ERROR="HTTP_INTERCEPTOR_ERROR",e}({}),u=function(e){return e.ROUTE_NOT_FOUND="NAV_ROUTE_NOT_FOUND",e.NAVIGATION_BLOCKED="NAV_BLOCKED",e.NAVIGATION_TIMEOUT="NAV_TIMEOUT",e.DEEP_LINK_ERROR="NAV_DEEP_LINK_ERROR",e.BACK_NAVIGATION_ERROR="NAV_BACK_ERROR",e}({}),g=function(e){return e.SUBMIT_FAILED="FORM_SUBMIT_FAILED",e.VALIDATION_FAILED="FORM_VALIDATION_FAILED",e.RESET_FAILED="FORM_RESET_FAILED",e.FIELD_UPDATE_FAILED="FORM_FIELD_UPDATE_FAILED",e.UPLOAD_FAILED="FORM_UPLOAD_FAILED",e}({}),_=function(e){return e.UPDATE_FAILED="STATE_UPDATE_FAILED",e.SYNC_FAILED="STATE_SYNC_FAILED",e.REDUCER_ERROR="STATE_REDUCER_ERROR",e.MIDDLEWARE_ERROR="STATE_MIDDLEWARE_ERROR",e.PERSISTENCE_FAILED="STATE_PERSISTENCE_FAILED",e}({});({...Object.values(r).reduce((e,t)=>({...e,[t]:"network"}),{}),...Object.values(o).reduce((e,t)=>({...e,[t]:"validation"}),{}),...Object.values(n).reduce((e,t)=>({...e,[t]:"runtime"}),{}),...Object.values(i).reduce((e,t)=>({...e,[t]:"ui"}),{}),...Object.values(s).reduce((e,t)=>({...e,[t]:"storage"}),{}),...Object.values(l).reduce((e,t)=>({...e,[t]:"media"}),{}),...Object.values(c).reduce((e,t)=>({...e,[t]:"third_party"}),{}),...Object.values(d).reduce((e,t)=>({...e,[t]:"http"}),{}),...Object.values(u).reduce((e,t)=>({...e,[t]:"navigation"}),{}),...Object.values(g).reduce((e,t)=>({...e,[t]:"form"}),{}),...Object.values(_).reduce((e,t)=>({...e,[t]:"state"}),{})})},91765:(e,t,a)=>{"use strict";a.d(t,{F4:()=>y.F4,sc:()=>y.sc,errorTracker:()=>B,AU:()=>u,yj:()=>E,vF:()=>M,Dd:()=>H,pk:()=>q});var r=a(20789),o=a(33053),n=a(51748),i=a(73382),s=a(8096),l=a(97290);let c=null,d=!1;async function u(){if(d)return void console.log("[Firebase] Already initialized");let e=function(){let e=l.$W.services.firebaseConfig;if(!e)return console.warn("[Firebase] No Firebase config found in environment variables"),null;try{return JSON.parse(e)}catch(e){return console.error("[Firebase] Failed to parse Firebase config:",e),null}}();if(!e)return void console.warn("[Firebase] Skipping initialization - no config available");try{if(c=(0,r.Wp)(e),console.log("[Firebase] Firebase app initialized"),l.$W.isDevelopment)try{(0,o.P5)(c),console.log("[Firebase] Web Analytics initialized (dev only)")}catch(e){console.warn("[Firebase] Failed to initialize Web Analytics:",e)}try{await n.gT.setEnabled({enabled:!0}),console.log("[Firebase] ✅ Analytics enabled"),l.$W.isDevelopment&&(await n.gT.setSessionTimeoutDuration({duration:18e5}),console.log("[Firebase] ✅ Analytics Debug Mode enabled"))}catch(e){console.warn("[Firebase] Failed to enable Analytics:",e)}if(l.$W.monitoring.errorReporting)try{await i.X.setEnabled({enabled:!0}),console.log("[Firebase] ✅ Crashlytics enabled")}catch(e){console.warn("[Firebase] Failed to enable Crashlytics:",e)}if(l.$W.monitoring.performanceMonitoring)try{await s.o.setEnabled({enabled:!0}),console.log("[Firebase] ✅ Performance Monitoring enabled")}catch(e){console.warn("[Firebase] Failed to enable Performance Monitoring:",e)}if(l.$W.isDevelopment||l.$W.isStaging)try{await n.gT.setUserProperty({key:"environment",value:l.$W.name}),await n.gT.setUserProperty({key:"app_version",value:l.$W.appVersion}),console.log("[Firebase] User properties set")}catch(e){console.warn("[Firebase] Failed to set user properties:",e)}d=!0,console.log("[Firebase] ✅ Firebase initialized successfully")}catch(e){console.error("[Firebase] ❌ Failed to initialize Firebase:",e)}}async function g(e,t){if(!d)return void console.warn("[Firebase] Cannot log event - Firebase not initialized");try{await n.gT.logEvent({name:e,params:t||{}}),l.$W.isDevelopment&&console.log("[Firebase Analytics] Event: ".concat(e),t)}catch(e){console.error("[Firebase] Failed to log analytics event:",e)}}async function _(e,t){if(!d)return void console.warn("[Firebase] Cannot log crash - Firebase not initialized");if(l.$W.monitoring.errorReporting)try{if(t)for(let[e,a]of Object.entries(t))await i.X.setCustomKey({key:e,value:a,type:"string"});await i.X.log({message:"".concat(e.name,": ").concat(e.message)}),await i.X.recordException({message:"".concat(e.name,": ").concat(e.message,"\n").concat(e.stack||"")}),l.$W.isDevelopment&&console.log("[Firebase Crashlytics] Error logged:",e,t)}catch(e){console.error("[Firebase] Failed to log crash:",e)}}async function f(e){if(d&&l.$W.monitoring.performanceMonitoring)try{await s.o.startTrace({traceName:e}),l.$W.isDevelopment&&console.log("[Firebase Performance] Trace started: ".concat(e))}catch(e){console.error("[Firebase] Failed to start trace:",e)}}async function p(e,t){if(d&&l.$W.monitoring.performanceMonitoring)try{await s.o.stopTrace({traceName:e}),l.$W.isDevelopment&&console.log("[Firebase Performance] Trace stopped: ".concat(e))}catch(e){console.error("[Firebase] Failed to stop trace:",e)}}function E(){return d}class m{async notify(e){this.enabled&&this.webhookUrl&&this.sendAsync(e).catch(e=>{console.error("[SlackNotifier] Failed to send notification:",e)})}async sendAsync(e){if(this.webhookUrl)try{let t=this.formatPayload(e),a=await fetch(this.webhookUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!a.ok)throw Error("Slack API returned ".concat(a.status));console.log("[SlackNotifier] ✅ Notification sent to Slack")}catch(e){throw console.error("[SlackNotifier] ❌ Failed to send to Slack:",e),e}}formatPayload(e){let{title:t,message:a,severity:r,metadata:o,stackTrace:n}=e,i=[];i.push({title:"Environment",value:l.$W.name,short:!0}),i.push({title:"App Version",value:"".concat(l.$W.appVersion," (").concat(l.$W.buildNumber,")"),short:!0}),o&&Object.entries(o).forEach(e=>{let[t,a]=e;i.push({title:t,value:String(a),short:!0})});let s={text:"".concat({info:":information_source:",warning:":warning:",error:":x:",critical:":rotating_light:"}[r]," *").concat(t,"*"),attachments:[{color:{info:"#36a64f",warning:"#ff9800",error:"#f44336",critical:"#9c27b0"}[r],title:t,text:a,fields:i,footer:"Guide Tool Monitoring",footer_icon:"https://firebase.google.com/favicon.ico",ts:Math.floor(Date.now()/1e3)}]};return n&&(s.attachments=[...s.attachments,{color:"#cccccc",title:"Stack Trace",text:"```".concat(n.substring(0,1e3),"```"),footer:"Stack Trace (truncated to 1000 chars)"}]),s}async notifyLogError(e,t){await this.notify({title:"Log Error",message:e,severity:"error",metadata:t?this.stringifyMetadata(t):void 0})}async notifyErrorReport(e,t){let a=(null==t?void 0:t.severity)&&({low:"info",medium:"warning",high:"error",critical:"critical"})[t.severity]||"error",r={};t&&(t.errorCode&&(r.errorCode=t.errorCode),t.component&&(r.component=t.component),t.action&&(r.action=t.action),t.userId&&(r.userId=t.userId),t.apiEndpoint&&(r.apiEndpoint=t.apiEndpoint),t.statusCode&&(r.statusCode=t.statusCode.toString()),t.method&&(r.method=t.method)),await this.notify({title:"Error: ".concat(e.name),message:e.message,severity:a,metadata:Object.keys(r).length>0?r:void 0,stackTrace:e.stack})}stringifyMetadata(e){let t={};for(let[a,r]of Object.entries(e))t[a]="string"==typeof r?r:JSON.stringify(r);return t}constructor(){this.webhookUrl=l.$W.slackWebhookUrl||null,this.enabled=!!this.webhookUrl&&l.$W.monitoring.errorReporting,this.enabled?console.log("[SlackNotifier] ✅ Slack notifications enabled"):console.log("[SlackNotifier] ⚠️ Slack notifications disabled (no webhook URL or monitoring disabled)")}}let v=null,I=v=new m,R={app_launch:{eventType:"app_launch",template:"Application launched",expectedMetadata:["version","buildNumber","platform","deviceModel"]},app_foreground:{eventType:"app_foreground",template:"Application entered foreground",expectedMetadata:["timestamp"]},app_background:{eventType:"app_background",template:"Application entered background",expectedMetadata:["timestamp","duration"]},app_terminate:{eventType:"app_terminate",template:"Application terminated",expectedMetadata:["reason"]},user_login:{eventType:"user_login",template:"User logged in",expectedMetadata:["userId","loginMethod"]},user_logout:{eventType:"user_logout",template:"User logged out",expectedMetadata:["userId","reason"]},user_register:{eventType:"user_register",template:"User registered",expectedMetadata:["userId","registrationMethod"]},user_profile_update:{eventType:"user_profile_update",template:"User profile updated",expectedMetadata:["userId","updatedFields"]},page_view:{eventType:"page_view",template:"Page viewed",expectedMetadata:["pageName","pageUrl","referrer"]},page_load_start:{eventType:"page_load_start",template:"Page load started",expectedMetadata:["pageName","timestamp"]},page_load_complete:{eventType:"page_load_complete",template:"Page load completed",expectedMetadata:["pageName","loadTime"]},navigation:{eventType:"navigation",template:"Navigation occurred",expectedMetadata:["from","to","method"]},api_request_start:{eventType:"api_request_start",template:"API request started",expectedMetadata:["method","url","requestId"]},api_request_success:{eventType:"api_request_success",template:"API request succeeded",expectedMetadata:["method","url","statusCode","duration","requestId"]},api_request_failure:{eventType:"api_request_failure",template:"API request failed",expectedMetadata:["method","url","statusCode","errorCode","duration","requestId"]},api_request_retry:{eventType:"api_request_retry",template:"API request retry",expectedMetadata:["method","url","retryCount","requestId"]},data_fetch:{eventType:"data_fetch",template:"Data fetched",expectedMetadata:["dataType","count","source"]},data_create:{eventType:"data_create",template:"Data created",expectedMetadata:["dataType","id"]},data_update:{eventType:"data_update",template:"Data updated",expectedMetadata:["dataType","id","updatedFields"]},data_delete:{eventType:"data_delete",template:"Data deleted",expectedMetadata:["dataType","id"]},data_sync:{eventType:"data_sync",template:"Data synchronized",expectedMetadata:["dataType","direction","count"]},cache_hit:{eventType:"cache_hit",template:"Cache hit",expectedMetadata:["cacheKey","dataType"]},cache_miss:{eventType:"cache_miss",template:"Cache miss",expectedMetadata:["cacheKey","dataType"]},cache_clear:{eventType:"cache_clear",template:"Cache cleared",expectedMetadata:["scope"]},cache_update:{eventType:"cache_update",template:"Cache updated",expectedMetadata:["cacheKey","dataType"]},performance_trace_start:{eventType:"performance_trace_start",template:"Performance trace started",expectedMetadata:["traceName"]},performance_trace_stop:{eventType:"performance_trace_stop",template:"Performance trace stopped",expectedMetadata:["traceName","duration"]},slow_operation:{eventType:"slow_operation",template:"Slow operation detected",expectedMetadata:["operation","duration","threshold"]},network_online:{eventType:"network_online",template:"Network connection restored",expectedMetadata:["connectionType"]},network_offline:{eventType:"network_offline",template:"Network connection lost",expectedMetadata:["timestamp"]},network_slow:{eventType:"network_slow",template:"Slow network detected",expectedMetadata:["connectionType","effectiveType"]},storage_read:{eventType:"storage_read",template:"Storage read",expectedMetadata:["key","storageType"]},storage_write:{eventType:"storage_write",template:"Storage write",expectedMetadata:["key","storageType","size"]},storage_delete:{eventType:"storage_delete",template:"Storage delete",expectedMetadata:["key","storageType"]},storage_clear:{eventType:"storage_clear",template:"Storage cleared",expectedMetadata:["storageType"]},feature_enabled:{eventType:"feature_enabled",template:"Feature enabled",expectedMetadata:["featureName"]},feature_disabled:{eventType:"feature_disabled",template:"Feature disabled",expectedMetadata:["featureName"]},feature_usage:{eventType:"feature_usage",template:"Feature used",expectedMetadata:["featureName","action"]},settings_updated:{eventType:"settings_updated",template:"Settings updated",expectedMetadata:["settingKey","oldValue","newValue"]},preferences_changed:{eventType:"preferences_changed",template:"Preferences changed",expectedMetadata:["preferenceKey","value"]},debug_info:{eventType:"debug_info",template:"Debug info",expectedMetadata:["context","data"]},debug_state:{eventType:"debug_state",template:"Debug state",expectedMetadata:["component","state"]},debug_action:{eventType:"debug_action",template:"Debug action",expectedMetadata:["action","payload"]}};function A(e){let t=R[e];if(t)return{defaultMessage:t.template,template:t.template}}var y=a(85550),O=a(754);let h={DEBUG:0,INFO:1,WARN:2,ERROR:3};class T{shouldLog(e){let t=h[l.$W.monitoring.logLevel];return h[e]>=t}formatMetadata(e){if(!e)return{};let t={};for(let[a,r]of Object.entries(e))t[a]="string"==typeof r?r:JSON.stringify(r);return t}async logWithMetadata(e,t){if(!this.shouldLog(e))return;if(t.eventType){let e=function(e,t){let a=R[e];if(!a||!a.expectedMetadata)return{valid:!0,missingFields:[]};let r=a.expectedMetadata.filter(e=>!t||!(e in t));return{valid:0===r.length,missingFields:r}}(t.eventType,t);if(!e.valid){let r="Incomplete log metadata for ".concat(t.eventType,": missing fields [").concat(e.missingFields.join(", "),"]");if(l.$W.isDevelopment)console.warn("[FirebaseLogger] ⚠️ ".concat(r));else{console.error("[FirebaseLogger] ".concat(r));try{let{errorTracker:o}=await Promise.resolve().then(a.bind(a,91765));o.report(Error(r),{errorCode:y.hg.INVALID_FORMAT,component:"FirebaseLogger",action:"logWithMetadata",severity:O.MU.MEDIUM,metadata:{eventType:t.eventType,missingFields:e.missingFields.join(","),providedFields:Object.keys(t).join(",")}})}catch(e){console.error("[FirebaseLogger] Failed to report incomplete metadata:",e)}}}}let r="";if(t.eventType){let e=A(t.eventType);r=(null==e?void 0:e.defaultMessage)||t.eventType}let o="ERROR"===e?"error":"WARN"===e?"warn":"log";if(console[o]("[".concat(e,"]"),r||t.eventType,t),l.$W.monitoring.errorReporting||l.$W.monitoring.performanceMonitoring)try{let a={severity:e,environment:l.$W.name};t.eventType&&(a.event_type=t.eventType),t.component&&(a.component=t.component),t.action&&(a.action=t.action),t.userId&&(a.user_id=t.userId),t.sessionId&&(a.session_id=t.sessionId),t.traceId&&(a.trace_id=t.traceId),t.apiEndpoint&&(a.api_endpoint=t.apiEndpoint),t.statusCode&&(a.status_code=t.statusCode.toString()),t.method&&(a.method=t.method),t.duration&&(a.duration=t.duration.toString()),t.error&&(a.error=t.error.substring(0,100)),t.metadata&&Object.entries(t.metadata).forEach(e=>{let[t,r]=e;a["meta_".concat(t)]=String(r).substring(0,100)}),await g("app_log",a)}catch(e){console.error("[FirebaseLogger] Failed to log:",e)}}async log(e,t,a){if(!this.shouldLog(e))return;let r="ERROR"===e?"error":"WARN"===e?"warn":"log";if(console[r]("[".concat(e,"] ").concat(t),a||""),l.$W.monitoring.errorReporting||l.$W.monitoring.performanceMonitoring)try{await g("app_log",{severity:e,environment:l.$W.name,message:t.substring(0,100),...this.formatMetadata(a)})}catch(e){console.error("[FirebaseLogger] Failed to log:",e)}}async debug(e,t){return"string"==typeof e?this.log("DEBUG",e,t):this.logWithMetadata("DEBUG",e)}async info(e,t){return"string"==typeof e?this.log("INFO",e,t):this.logWithMetadata("INFO",e)}async warn(e,t){return"string"==typeof e?this.log("WARN",e,t):this.logWithMetadata("WARN",e)}async error(e,t){if("string"==typeof e)return I.notifyLogError(e,t).catch(e=>{console.error("[FirebaseLogger] Failed to send Slack notification:",e)}),this.log("ERROR",e,t);let a=e.eventType&&A(e.eventType)?A(e.eventType).defaultMessage:e.eventType||"Unknown error";return I.notifyLogError(a,e).catch(e=>{console.error("[FirebaseLogger] Failed to send Slack notification:",e)}),this.logWithMetadata("ERROR",e)}async batch(e){for(let t of e)await this.log(t.severity,t.message,t.metadata)}constructor(){this.logLevel=l.$W.monitoring.logLevel,console.log("[FirebaseLogger] ✅ Logger initialized with Firebase")}}let S=null,M=S=new T,F={[y.Sc.NO_CONNECTION]:{code:y.Sc.NO_CONNECTION,userMessageKey:"errors.network.no_connection.message",developerMessage:"Network connection is not available",suggestedActionKey:"errors.network.no_connection.action",defaultMessage:"無法連線到網路，請檢查您的網路連線",defaultAction:"請檢查 Wi-Fi 或行動網路是否已開啟"},[y.Sc.TIMEOUT]:{code:y.Sc.TIMEOUT,userMessageKey:"errors.network.timeout.message",developerMessage:"Network request timeout",suggestedActionKey:"errors.network.timeout.action",defaultMessage:"連線逾時，請稍後再試",defaultAction:"請確認網路連線穩定後重試"},[y.Sc.ABORTED]:{code:y.Sc.ABORTED,userMessageKey:"errors.network.aborted.message",developerMessage:"Network request was aborted",defaultMessage:"請求已取消"},[y.Sc.DNS_FAILED]:{code:y.Sc.DNS_FAILED,userMessageKey:"errors.network.dns_failed.message",developerMessage:"DNS resolution failed",suggestedActionKey:"errors.network.dns_failed.action",defaultMessage:"無法解析伺服器位址",defaultAction:"請檢查網路設定或稍後再試"},[y.Sc.SSL_ERROR]:{code:y.Sc.SSL_ERROR,userMessageKey:"errors.network.ssl_error.message",developerMessage:"SSL/TLS certificate validation failed",suggestedActionKey:"errors.network.ssl_error.action",defaultMessage:"連線安全性驗證失敗",defaultAction:"請確認系統時間正確或聯絡技術支援"},[y.Sc.UNSTABLE]:{code:y.Sc.UNSTABLE,userMessageKey:"errors.network.unstable.message",developerMessage:"Network connection is unstable",suggestedActionKey:"errors.network.unstable.action",defaultMessage:"網路連線不穩定",defaultAction:"請移動到訊號較佳的位置"}},w={[y.hg.REQUIRED_FIELD_EMPTY]:{code:y.hg.REQUIRED_FIELD_EMPTY,userMessageKey:"errors.validation.required_field_empty.message",developerMessage:"Required field is empty",defaultMessage:"此欄位為必填"},[y.hg.INVALID_FORMAT]:{code:y.hg.INVALID_FORMAT,userMessageKey:"errors.validation.invalid_format.message",developerMessage:"Invalid format",defaultMessage:"格式不正確"},[y.hg.INVALID_EMAIL]:{code:y.hg.INVALID_EMAIL,userMessageKey:"errors.validation.invalid_email.message",developerMessage:"Invalid email format",suggestedActionKey:"errors.validation.invalid_email.action",defaultMessage:"Email 格式不正確",defaultAction:"請輸入有效的 Email 地址"},[y.hg.INVALID_PHONE]:{code:y.hg.INVALID_PHONE,userMessageKey:"errors.validation.invalid_phone.message",developerMessage:"Invalid phone number format",suggestedActionKey:"errors.validation.invalid_phone.action",defaultMessage:"手機號碼格式不正確",defaultAction:"請輸入有效的手機號碼"},[y.hg.WEAK_PASSWORD]:{code:y.hg.WEAK_PASSWORD,userMessageKey:"errors.validation.weak_password.message",developerMessage:"Password does not meet strength requirements",suggestedActionKey:"errors.validation.weak_password.action",defaultMessage:"密碼強度不足",defaultAction:"密碼需包含大小寫字母、數字及特殊符號"},[y.hg.PASSWORD_MISMATCH]:{code:y.hg.PASSWORD_MISMATCH,userMessageKey:"errors.validation.password_mismatch.message",developerMessage:"Password confirmation does not match",defaultMessage:"兩次輸入的密碼不一致"},[y.hg.OUT_OF_RANGE]:{code:y.hg.OUT_OF_RANGE,userMessageKey:"errors.validation.out_of_range.message",developerMessage:"Value is out of valid range",defaultMessage:"數值超出允許範圍"},[y.hg.INVALID_LENGTH]:{code:y.hg.INVALID_LENGTH,userMessageKey:"errors.validation.invalid_length.message",developerMessage:"Invalid length",defaultMessage:"長度不符合要求"},[y.hg.INVALID_DATE]:{code:y.hg.INVALID_DATE,userMessageKey:"errors.validation.invalid_date.message",developerMessage:"Invalid date format",defaultMessage:"日期格式不正確"},[y.hg.INVALID_FILE_TYPE]:{code:y.hg.INVALID_FILE_TYPE,userMessageKey:"errors.validation.invalid_file_type.message",developerMessage:"File type is not supported",defaultMessage:"不支援此檔案類型"},[y.hg.FILE_TOO_LARGE]:{code:y.hg.FILE_TOO_LARGE,userMessageKey:"errors.validation.file_too_large.message",developerMessage:"File size exceeds limit",defaultMessage:"檔案大小超過限制"}},D={[y.mZ.RUNTIME_ERROR]:{code:y.mZ.RUNTIME_ERROR,userMessageKey:"errors.runtime.runtime_error.message",developerMessage:"Runtime error occurred",defaultMessage:"系統發生錯誤"},[y.mZ.OUT_OF_MEMORY]:{code:y.mZ.OUT_OF_MEMORY,userMessageKey:"errors.runtime.out_of_memory.message",developerMessage:"Out of memory",suggestedActionKey:"errors.runtime.out_of_memory.action",defaultMessage:"記憶體不足",defaultAction:"請關閉其他應用程式後重試"},[y.mZ.UNEXPECTED_ERROR]:{code:y.mZ.UNEXPECTED_ERROR,userMessageKey:"errors.runtime.unexpected_error.message",developerMessage:"Unexpected error occurred",defaultMessage:"發生未預期的錯誤"},[y.mZ.INITIALIZATION_FAILED]:{code:y.mZ.INITIALIZATION_FAILED,userMessageKey:"errors.runtime.initialization_failed.message",developerMessage:"Initialization failed",suggestedActionKey:"errors.runtime.initialization_failed.action",defaultMessage:"初始化失敗",defaultAction:"請重新啟動應用程式"},[y.mZ.SERVICE_UNAVAILABLE]:{code:y.mZ.SERVICE_UNAVAILABLE,userMessageKey:"errors.runtime.service_unavailable.message",developerMessage:"Service is currently unavailable",defaultMessage:"服務暫時無法使用"},[y.mZ.FEATURE_NOT_SUPPORTED]:{code:y.mZ.FEATURE_NOT_SUPPORTED,userMessageKey:"errors.runtime.feature_not_supported.message",developerMessage:"Feature is not supported on this device/browser",defaultMessage:"此功能不支援您的裝置或瀏覽器"}},N={[y.sc.COMPONENT_RENDER_ERROR]:{code:y.sc.COMPONENT_RENDER_ERROR,userMessageKey:"errors.ui.component_render_error.message",developerMessage:"Component failed to render",defaultMessage:"頁面顯示發生錯誤"},[y.sc.DATA_LOAD_ERROR]:{code:y.sc.DATA_LOAD_ERROR,userMessageKey:"errors.ui.data_load_error.message",developerMessage:"Failed to load data",suggestedActionKey:"errors.ui.data_load_error.action",defaultMessage:"資料載入失敗",defaultAction:"請重新整理頁面"},[y.sc.IMAGE_LOAD_ERROR]:{code:y.sc.IMAGE_LOAD_ERROR,userMessageKey:"errors.ui.image_load_error.message",developerMessage:"Failed to load image",defaultMessage:"圖片載入失敗"},[y.sc.VIDEO_PLAY_ERROR]:{code:y.sc.VIDEO_PLAY_ERROR,userMessageKey:"errors.ui.video_play_error.message",developerMessage:"Failed to play video",defaultMessage:"影片播放失敗"},[y.sc.INTERACTION_TIMEOUT]:{code:y.sc.INTERACTION_TIMEOUT,userMessageKey:"errors.ui.interaction_timeout.message",developerMessage:"User interaction timeout",defaultMessage:"操作逾時"},[y.sc.INFINITE_LOOP_DETECTED]:{code:y.sc.INFINITE_LOOP_DETECTED,userMessageKey:"errors.ui.infinite_loop_detected.message",developerMessage:"Infinite loop detected in component",defaultMessage:"偵測到無限迴圈"}},L={[y.F4.STORAGE_FULL]:{code:y.F4.STORAGE_FULL,userMessageKey:"errors.storage.storage_full.message",developerMessage:"Storage is full",suggestedActionKey:"errors.storage.storage_full.action",defaultMessage:"儲存空間不足",defaultAction:"請清理裝置儲存空間"},[y.F4.FILE_READ_ERROR]:{code:y.F4.FILE_READ_ERROR,userMessageKey:"errors.storage.file_read_error.message",developerMessage:"Failed to read file",defaultMessage:"檔案讀取失敗"},[y.F4.FILE_WRITE_ERROR]:{code:y.F4.FILE_WRITE_ERROR,userMessageKey:"errors.storage.file_write_error.message",developerMessage:"Failed to write file",defaultMessage:"檔案寫入失敗"},[y.F4.LOCALSTORAGE_ERROR]:{code:y.F4.LOCALSTORAGE_ERROR,userMessageKey:"errors.storage.localstorage_error.message",developerMessage:"LocalStorage operation failed",defaultMessage:"LocalStorage 操作失敗"},[y.F4.SESSIONSTORAGE_ERROR]:{code:y.F4.SESSIONSTORAGE_ERROR,userMessageKey:"errors.storage.sessionstorage_error.message",developerMessage:"SessionStorage operation failed",defaultMessage:"SessionStorage 操作失敗"},[y.F4.INDEXEDDB_ERROR]:{code:y.F4.INDEXEDDB_ERROR,userMessageKey:"errors.storage.indexeddb_error.message",developerMessage:"IndexedDB operation failed",defaultMessage:"IndexedDB 操作失敗"},[y.F4.COOKIE_ERROR]:{code:y.F4.COOKIE_ERROR,userMessageKey:"errors.storage.cookie_error.message",developerMessage:"Cookie operation failed",defaultMessage:"Cookie 操作失敗"},[y.F4.CACHE_ERROR]:{code:y.F4.CACHE_ERROR,userMessageKey:"errors.storage.cache_error.message",developerMessage:"Cache operation failed",defaultMessage:"快取操作失敗"}},b={[y.ou.CAMERA_PERMISSION_DENIED]:{code:y.ou.CAMERA_PERMISSION_DENIED,userMessageKey:"errors.media.camera_permission_denied.message",developerMessage:"Camera permission denied",suggestedActionKey:"errors.media.camera_permission_denied.action",defaultMessage:"相機權限被拒絕",defaultAction:"請至設定中開啟相機權限"},[y.ou.CAMERA_INIT_FAILED]:{code:y.ou.CAMERA_INIT_FAILED,userMessageKey:"errors.media.camera_init_failed.message",developerMessage:"Failed to initialize camera",defaultMessage:"相機初始化失敗"},[y.ou.MICROPHONE_PERMISSION_DENIED]:{code:y.ou.MICROPHONE_PERMISSION_DENIED,userMessageKey:"errors.media.microphone_permission_denied.message",developerMessage:"Microphone permission denied",suggestedActionKey:"errors.media.microphone_permission_denied.action",defaultMessage:"麥克風權限被拒絕",defaultAction:"請至設定中開啟麥克風權限"},[y.ou.MICROPHONE_INIT_FAILED]:{code:y.ou.MICROPHONE_INIT_FAILED,userMessageKey:"errors.media.microphone_init_failed.message",developerMessage:"Failed to initialize microphone",defaultMessage:"麥克風初始化失敗"},[y.ou.LOCATION_PERMISSION_DENIED]:{code:y.ou.LOCATION_PERMISSION_DENIED,userMessageKey:"errors.media.location_permission_denied.message",developerMessage:"Location permission denied",suggestedActionKey:"errors.media.location_permission_denied.action",defaultMessage:"位置權限被拒絕",defaultAction:"請至設定中開啟位置權限"},[y.ou.LOCATION_SERVICE_DISABLED]:{code:y.ou.LOCATION_SERVICE_DISABLED,userMessageKey:"errors.media.location_service_disabled.message",developerMessage:"Location service is disabled",suggestedActionKey:"errors.media.location_service_disabled.action",defaultMessage:"位置服務未開啟",defaultAction:"請開啟裝置的位置服務"},[y.ou.LOCATION_TIMEOUT]:{code:y.ou.LOCATION_TIMEOUT,userMessageKey:"errors.media.location_timeout.message",developerMessage:"Location request timeout",defaultMessage:"位置取得逾時"},[y.ou.NOTIFICATION_PERMISSION_DENIED]:{code:y.ou.NOTIFICATION_PERMISSION_DENIED,userMessageKey:"errors.media.notification_permission_denied.message",developerMessage:"Notification permission denied",suggestedActionKey:"errors.media.notification_permission_denied.action",defaultMessage:"通知權限被拒絕",defaultAction:"請至設定中開啟通知權限"}},k={[y.li.FIREBASE_INIT_ERROR]:{code:y.li.FIREBASE_INIT_ERROR,userMessageKey:"errors.third_party.firebase_init_error.message",developerMessage:"Failed to initialize Firebase",defaultMessage:"Firebase 初始化失敗"},[y.li.FIREBASE_ANALYTICS_ERROR]:{code:y.li.FIREBASE_ANALYTICS_ERROR,userMessageKey:"errors.third_party.firebase_analytics_error.message",developerMessage:"Firebase Analytics error",defaultMessage:"Firebase Analytics 錯誤"},[y.li.FIREBASE_CRASHLYTICS_ERROR]:{code:y.li.FIREBASE_CRASHLYTICS_ERROR,userMessageKey:"errors.third_party.firebase_crashlytics_error.message",developerMessage:"Firebase Crashlytics error",defaultMessage:"Firebase Crashlytics 錯誤"},[y.li.GOOGLE_MAPS_LOAD_ERROR]:{code:y.li.GOOGLE_MAPS_LOAD_ERROR,userMessageKey:"errors.third_party.google_maps_load_error.message",developerMessage:"Failed to load Google Maps",defaultMessage:"Google Maps 載入失敗"},[y.li.SOCIAL_LOGIN_ERROR]:{code:y.li.SOCIAL_LOGIN_ERROR,userMessageKey:"errors.third_party.social_login_error.message",developerMessage:"Social login failed",defaultMessage:"社群登入失敗"},[y.li.FACEBOOK_SDK_ERROR]:{code:y.li.FACEBOOK_SDK_ERROR,userMessageKey:"errors.third_party.facebook_sdk_error.message",developerMessage:"Facebook SDK error",defaultMessage:"Facebook SDK 錯誤"},[y.li.GOOGLE_SDK_ERROR]:{code:y.li.GOOGLE_SDK_ERROR,userMessageKey:"errors.third_party.google_sdk_error.message",developerMessage:"Google SDK error",defaultMessage:"Google SDK 錯誤"},[y.li.LINE_SDK_ERROR]:{code:y.li.LINE_SDK_ERROR,userMessageKey:"errors.third_party.line_sdk_error.message",developerMessage:"Line SDK error",defaultMessage:"Line SDK 錯誤"}},C={[y.eo.REQUEST_CONFIG_ERROR]:{code:y.eo.REQUEST_CONFIG_ERROR,userMessageKey:"errors.http.request_config_error.message",developerMessage:"Invalid request configuration",defaultMessage:"請求配置錯誤"},[y.eo.REQUEST_CANCELLED]:{code:y.eo.REQUEST_CANCELLED,userMessageKey:"errors.http.request_cancelled.message",developerMessage:"Request was cancelled",defaultMessage:"請求已取消"},[y.eo.RESPONSE_PARSE_ERROR]:{code:y.eo.RESPONSE_PARSE_ERROR,userMessageKey:"errors.http.response_parse_error.message",developerMessage:"Failed to parse response",defaultMessage:"回應解析失敗"},[y.eo.CORS_ERROR]:{code:y.eo.CORS_ERROR,userMessageKey:"errors.http.cors_error.message",developerMessage:"CORS policy blocked the request",defaultMessage:"CORS 錯誤"},[y.eo.INTERCEPTOR_ERROR]:{code:y.eo.INTERCEPTOR_ERROR,userMessageKey:"errors.http.interceptor_error.message",developerMessage:"Request interceptor error",defaultMessage:"請求攔截器錯誤"}},P={[y.Gz.ROUTE_NOT_FOUND]:{code:y.Gz.ROUTE_NOT_FOUND,userMessageKey:"errors.navigation.route_not_found.message",developerMessage:"Route not found",defaultMessage:"頁面不存在"},[y.Gz.NAVIGATION_BLOCKED]:{code:y.Gz.NAVIGATION_BLOCKED,userMessageKey:"errors.navigation.navigation_blocked.message",developerMessage:"Navigation was blocked",defaultMessage:"導航被阻止"},[y.Gz.NAVIGATION_TIMEOUT]:{code:y.Gz.NAVIGATION_TIMEOUT,userMessageKey:"errors.navigation.navigation_timeout.message",developerMessage:"Navigation timeout",defaultMessage:"導航逾時"},[y.Gz.DEEP_LINK_ERROR]:{code:y.Gz.DEEP_LINK_ERROR,userMessageKey:"errors.navigation.deep_link_error.message",developerMessage:"Failed to handle deep link",defaultMessage:"深層連結錯誤"},[y.Gz.BACK_NAVIGATION_ERROR]:{code:y.Gz.BACK_NAVIGATION_ERROR,userMessageKey:"errors.navigation.back_navigation_error.message",developerMessage:"Back navigation error",defaultMessage:"返回操作失敗"}},U={[y.GB.SUBMIT_FAILED]:{code:y.GB.SUBMIT_FAILED,userMessageKey:"errors.form.submit_failed.message",developerMessage:"Form submission failed",defaultMessage:"表單提交失敗"},[y.GB.VALIDATION_FAILED]:{code:y.GB.VALIDATION_FAILED,userMessageKey:"errors.form.validation_failed.message",developerMessage:"Form validation failed",defaultMessage:"表單驗證失敗"},[y.GB.RESET_FAILED]:{code:y.GB.RESET_FAILED,userMessageKey:"errors.form.reset_failed.message",developerMessage:"Form reset failed",defaultMessage:"表單重置失敗"},[y.GB.FIELD_UPDATE_FAILED]:{code:y.GB.FIELD_UPDATE_FAILED,userMessageKey:"errors.form.field_update_failed.message",developerMessage:"Field update failed",defaultMessage:"欄位更新失敗"},[y.GB.UPLOAD_FAILED]:{code:y.GB.UPLOAD_FAILED,userMessageKey:"errors.form.upload_failed.message",developerMessage:"File upload failed",suggestedActionKey:"errors.form.upload_failed.action",defaultMessage:"檔案上傳失敗",defaultAction:"請確認檔案大小和格式是否符合要求"}},K={[y.fN.UPDATE_FAILED]:{code:y.fN.UPDATE_FAILED,userMessageKey:"errors.state.update_failed.message",developerMessage:"State update failed",defaultMessage:"狀態更新失敗"},[y.fN.SYNC_FAILED]:{code:y.fN.SYNC_FAILED,userMessageKey:"errors.state.sync_failed.message",developerMessage:"State synchronization failed",defaultMessage:"狀態同步失敗"},[y.fN.REDUCER_ERROR]:{code:y.fN.REDUCER_ERROR,userMessageKey:"errors.state.reducer_error.message",developerMessage:"Reducer error occurred",defaultMessage:"Reducer 錯誤"},[y.fN.MIDDLEWARE_ERROR]:{code:y.fN.MIDDLEWARE_ERROR,userMessageKey:"errors.state.middleware_error.message",developerMessage:"Middleware error occurred",defaultMessage:"Middleware 錯誤"},[y.fN.PERSISTENCE_FAILED]:{code:y.fN.PERSISTENCE_FAILED,userMessageKey:"errors.state.persistence_failed.message",developerMessage:"State persistence failed",defaultMessage:"狀態持久化失敗"}},W={...F,...w,...D,...N,...L,...b,...k,...C,...P,...U,...K};class G{report(e,t){l.$W.isDevelopment&&console.error("[FirebaseErrorTracker] Error reported:",e,t),l.$W.monitoring.errorReporting&&this.reportAsync(e,t).catch(e=>{console.error("[FirebaseErrorTracker] Failed to report error:",e)})}async reportAsync(e,t){try{let a={};if(t){a.errorCode=t.errorCode,a.component=t.component,a.action=t.action,t.severity&&(a.severity=t.severity),t.userId&&(a.userId=t.userId),t.sessionId&&(a.sessionId=t.sessionId),t.traceId&&(a.traceId=t.traceId),t.apiEndpoint&&(a.apiEndpoint=t.apiEndpoint),t.statusCode&&(a.statusCode=t.statusCode.toString()),t.method&&(a.method=t.method),t.pagePath&&(a.pagePath=t.pagePath),t.metadata&&Object.entries(t.metadata).forEach(e=>{let[t,r]=e;a["metadata_".concat(t)]=String(r)});let e=W[t.errorCode];e&&(a.userMessage=e.defaultMessage,a.developerMessage=e.developerMessage,e.defaultAction&&(a.suggestedAction=e.defaultAction))}a.environment=l.$W.name,a.appVersion=l.$W.appVersion,a.buildNumber=l.$W.buildNumber,await g("app_error",{error_name:e.name,error_message:e.message.substring(0,100),error_code:(null==t?void 0:t.errorCode)||"UNKNOWN",component:(null==t?void 0:t.component)||"unknown",action:(null==t?void 0:t.action)||"unknown",severity:(null==t?void 0:t.severity)||"medium",environment:l.$W.name}),await _(e,a);let r=t?{errorCode:t.errorCode,component:t.component,action:t.action,severity:t.severity,userId:t.userId,apiEndpoint:t.apiEndpoint,statusCode:t.statusCode,method:t.method}:void 0;I.notifyErrorReport(e,r).catch(e=>{console.error("[FirebaseErrorTracker] Failed to send Slack notification:",e)}),l.$W.isDevelopment&&console.log("[FirebaseErrorTracker] ✅ Error reported to Analytics, Crashlytics, and Slack")}catch(e){throw console.error("[FirebaseErrorTracker] ❌ Failed to upload error:",e),e}}reportNonFatal(e,t){this.report(e,{...t,metadata:{...t.metadata,isFatal:"false"}})}reportFatal(e,t){this.report(e,{...t,metadata:{...t.metadata,isFatal:"true"}})}constructor(){console.log("[FirebaseErrorTracker] ✅ Error Tracker initialized with Firebase")}}let x=null,B=x=new G;class V{record(e,t,a){l.$W.isDevelopment&&console.log("[FirebaseMetrics] ".concat(e,":"),t,a),l.$W.monitoring.performanceMonitoring&&this.recordAsync(e,t,a).catch(e=>{console.error("[FirebaseMetrics] Failed to record metric:",e)})}async recordAsync(e,t,a){try{await g("app_metric",{metric_name:e,metric_value:t,...a}),l.$W.isDevelopment&&console.log("[FirebaseMetrics] ✅ Metric recorded: ".concat(e," = ").concat(t))}catch(e){throw console.error("[FirebaseMetrics] ❌ Failed to record metric:",e),e}}async startTiming(e){let t=Date.now();this.activeTraces.set(e,t),l.$W.isDevelopment&&console.log("[FirebaseMetrics] ⏱️ Timing started: ".concat(e)),l.$W.monitoring.performanceMonitoring&&await f(e)}async stopTiming(e,t){let a=this.activeTraces.get(e);if(!a)return void console.warn("[FirebaseMetrics] No active timing found for: ".concat(e));let r=Date.now()-a;this.activeTraces.delete(e),l.$W.isDevelopment&&console.log("[FirebaseMetrics] ⏱️ Timing stopped: ".concat(e," = ").concat(r,"ms"),t),l.$W.monitoring.performanceMonitoring&&await p(e,t),await g("app_timing",{trace_name:e,duration_ms:r,...t})}recordPageLoad(e,t){this.record("page_load_time",t,{page:e})}recordApiRequest(e,t,a){this.record("api_request_duration",t,{endpoint:e,status:a.toString()})}recordUserAction(e,t){let a={action:e};void 0!==t&&(a.duration_ms=t),g("user_action",a).catch(e=>{console.error("[FirebaseMetrics] Failed to record user action:",e)})}recordAppStartup(e){this.record("app_startup_time",e,{environment:l.$W.name,version:l.$W.appVersion})}recordMemoryUsage(){if("performance"in window){let e=performance.memory;if(e){let t=Math.round(e.usedJSHeapSize/1024/1024);this.record("memory_usage_mb",t)}}}constructor(){this.activeTraces=new Map,console.log("[FirebaseMetricsCollector] ✅ Metrics Collector initialized with Firebase")}}let j=null,H=j=new V;class z{async checkHealth(){let e={memory:await this.checkMemory(),network:await this.checkNetwork(),storage:await this.checkStorage(),device:await this.checkDevice()},t=Object.values(e).map(e=>e.status),a="healthy";t.includes("unhealthy")?a="unhealthy":t.includes("degraded")&&(a="degraded");let r=[];return"unhealthy"===e.memory.status&&r.push("Memory usage is critical"),"unhealthy"===e.network.status&&r.push("Network is disconnected"),"unhealthy"===e.storage.status&&r.push("Storage is unavailable"),{status:a,timestamp:new Date().toISOString(),version:l.$W.appVersion,environment:l.$W.name,uptime:Date.now()-this.startTime,checks:e,errors:r.length>0?r:void 0}}async checkLiveness(){let e={memory:await this.checkMemory(),network:await this.checkNetwork(),storage:await this.checkStorage()};return{status:"unhealthy"===e.memory.status||"unhealthy"===e.storage.status?"dead":"alive",checks:e}}async checkReadiness(){let e={app_initialized:!0,i18n_loaded:this.checkI18nLoaded(),config_loaded:this.checkConfigLoaded()};return{status:Object.values(e).every(e=>e)?"ready":"not_ready",checks:e}}async checkMemory(){let e=performance.memory;if(!e)return{status:"healthy"};let t=e.usedJSHeapSize,a=e.jsHeapSizeLimit,r=t/a*100,o="healthy";return r>90?o="unhealthy":r>70&&(o="degraded"),{status:o,used:Math.round(t/1024/1024),total:Math.round(a/1024/1024),percentage:Math.round(r),unit:"MB"}}async checkNetwork(){if(!navigator.onLine)return{status:"unhealthy",connected:!1};let e=navigator.connection||navigator.mozConnection||navigator.webkitConnection,t="healthy";return navigator.onLine?((null==e?void 0:e.effectiveType)==="slow-2g"||(null==e?void 0:e.effectiveType)==="2g")&&(t="degraded"):t="unhealthy",{status:t,connected:navigator.onLine,type:null==e?void 0:e.type,effectiveType:null==e?void 0:e.effectiveType,downlink:null==e?void 0:e.downlink,rtt:null==e?void 0:e.rtt}}async checkStorage(){try{let e="__storage_test__";if(localStorage.setItem(e,"test"),localStorage.removeItem(e),"storage"in navigator&&"estimate"in navigator.storage){let e=await navigator.storage.estimate(),t=e.quota||0,a=e.usage||0,r=t>0?a/t*100:0,o="healthy";return r>90&&(o="degraded"),{status:o,available:!0,quota:Math.round(t/1024/1024),usage:Math.round(a/1024/1024),percentageUsed:Math.round(r)}}return{status:"healthy",available:!0}}catch(e){return{status:"unhealthy",available:!1}}}async checkDevice(){return{status:"healthy",platform:navigator.platform,userAgent:navigator.userAgent,language:navigator.language,online:navigator.onLine}}checkI18nLoaded(){return window.location.pathname.split("/").length>1}checkConfigLoaded(){return void 0!==l.$W.name&&void 0!==l.$W.apiUrl}getUptimeFormatted(){let e=Date.now()-this.startTime,t=Math.floor(e/1e3)%60,a=Math.floor(e/1e3/60)%60,r=Math.floor(e/1e3/60/60);return"".concat(r,"h ").concat(a,"m ").concat(t,"s")}constructor(){this.startTime=Date.now()}}new z;var $=a(45946);class Y{static getInstance(){return Y.instance||(Y.instance=new Y),Y.instance}async start(){if(this.isMonitoring)return void console.log("[NetworkMonitor] Already monitoring network status");if(!l.$W.isProduction&&!l.$W.isStaging)return void console.log("[NetworkMonitor] Network monitoring disabled in development");try{this.listenerHandle=await $.l.addListener("networkStatusChange",e=>{console.log("[NetworkMonitor] Network status changed:",e),e.connected&&(console.log("[NetworkMonitor] Network connected, retrying failed uploads"),this.retryFailedUploads())}),this.isMonitoring=!0,console.log("[NetworkMonitor] Started monitoring network status"),(await $.l.getStatus()).connected&&this.retryFailedUploads()}catch(e){console.error("[NetworkMonitor] Failed to start network monitoring:",e)}}async stop(){if(this.isMonitoring)try{this.listenerHandle&&(await this.listenerHandle.remove(),this.listenerHandle=null),this.isMonitoring=!1,console.log("[NetworkMonitor] Stopped monitoring network status")}catch(e){console.error("[NetworkMonitor] Failed to stop network monitoring:",e)}}async retryFailedUploads(){try{await M.info("Network connection restored"),console.log("[NetworkMonitor] Network restored, Firebase will auto-retry")}catch(e){console.error("[NetworkMonitor] Failed to log network restore:",e)}}async getStatus(){try{return await $.l.getStatus()}catch(e){return console.error("[NetworkMonitor] Failed to get network status:",e),null}}constructor(){this.isMonitoring=!1,this.listenerHandle=null}}Y.instance=null;let q=Y.getInstance()},97290:(e,t,a)=>{"use strict";a.d(t,{$W:()=>n});var r=a(55036);let o=(()=>{switch(r.env.NEXT_PUBLIC_APP_ENV||"production"){case"production":return"production";case"staging":return"staging";case"hotfix":return"hotfix";default:return"development"}})(),n={name:o,isDevelopment:"development"===o,isStaging:"staging"===o,isProduction:"production"===o,isHotfix:"hotfix"===o,apiUrl:"http://localhost:3020/api",apiTimeout:parseInt("30000",10),appName:"Guide Tool (Local)",appVersion:"1.0.0",buildNumber:"local",buildDate:r.env.NEXT_PUBLIC_BUILD_DATE||new Date().toISOString(),features:{analytics:!1,crashReporting:!1,pushNotifications:!1,debugMode:!0,mockData:!0,devTools:!0,useProxy:"development"===o,offlineMode:!1},offlineMode:{defaultVenueUid:"13nzxfiyt66b",autoDownload:!1,autoUpdate:!1},monitoring:{errorReporting:!1,performanceMonitoring:!1,debugPanel:!0,logLevel:"DEBUG"},services:{googleMapsKey:r.env.NEXT_PUBLIC_GOOGLE_MAPS_KEY,firebaseConfig:r.env.NEXT_PUBLIC_FIREBASE_CONFIG,sentryDsn:r.env.NEXT_PUBLIC_SENTRY_DSN,gtmId:r.env.NEXT_PUBLIC_GTM_ID},slackWebhookUrl:r.env.NEXT_PUBLIC_SLACK_WEBHOOK_URL};n.isDevelopment&&console.log("\uD83D\uDD27 Environment Configuration:",{environment:n.name,apiUrl:n.apiUrl,features:n.features,monitoring:n.monitoring})}}]);