"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9120],{89120:(e,t,n)=>{n.d(t,{_:()=>es});var i=n(47256),a=n(47251),o=n(7241),r=n(55587);function l(e){return{exhibitionID:e.uid,image:(0,r.eN)(e.img_key_vision),tag:(0,r.bB)(e.venue_locations),title:e.name}}function c(e){return{tourID:e.uid,image:(0,r.eN)(e.img_key_vision),tag:(0,r.hT)(e.target_audience),title:e.name,recommendStayTime:Math.round(e.duration_sec/60),workAmount:e.num_works,targetAudience:e.target_audience}}function u(e){var t;let n=e.venue_location,i=n.name,a=(null==(t=n.spaces[0])?void 0:t.name)||"";return{workID:e.uid,image:(0,r.eN)(e.img_key_vision),title:e.name,floor:i,room:a}}function d(e){var t;return{venueInfo:{title:(t=e.venue).title,subtitle:t.sub_title,image:(0,r.eN)(t.img_key_vision)},nearbyExhibition:void 0,currentExhibitions:e.exhibitions.map(l),themeTours:e.themes.map(c),hotWorks:e.works.map(u)}}var s=n(26945),g=n(91765),h=n(28496),m=n(97290),v=n(47077),f=n(28404),_=n(85110);async function p(){return m.$W.features.mockData||g.vF.warn("Real Beacon scanning not implemented yet, falling back to mock data"),b()}async function b(){await new Promise(e=>setTimeout(e,h.KW.scanInterval/6));let e=[{id:"beacon-101",uuid:h.KW.uuid||"E2C56DB5-DFFB-48D2-B060-D0F5A71096E0",major:1,minor:1,rssi:h.KW.rssiThreshold+10,distance:h.KW.proximityTriggerDistance+2.2,proximity:"near"}];return{timestamp:new Date().toISOString(),beacons:e}}async function w(){}async function y(e){if(await (0,_.j1)()){for(let t of(g.vF.debug("[beaconService] Offline mode - beacon to exhibition mapping not available",{beaconIds:e}),e))try{let e=await (0,f.XL)(t);e&&g.vF.debug("[beaconService] Found beacon in package",{beaconId:t,beaconUid:e.uid,venueSpaceUid:e.venue_space_uid})}catch(e){g.vF.error("[beaconService] Error reading beacon from package",{error:e instanceof Error?e.message:String(e),beaconId:t})}return[]}try{let t=[];for(let n of e)try{let e=await (0,v.$4)("zh-TW","adult"),i=s.Sn.EXHIBITION_BY_BEACON(n,{venue_uid:e,lang:"zh-TW",content_type:"adult"}),a=m.$W.apiUrl||"http://localhost:3020/api",o=new URL(i,a).toString(),r=await fetch(o);if(r.ok){let e=await r.json();Array.isArray(e)&&e.forEach(e=>{t.push({beacon_id:n,exhibition_id:e.uid})})}}catch(e){g.vF.error("Error fetching beacon mapping for single beacon",{error:e instanceof Error?e.message:String(e),beaconId:n})}return t}catch(t){return g.vF.error("Error fetching beacon mappings",{error:t instanceof Error?t.message:String(t),beaconIds:e}),[]}}async function D(){try{let e=await p();if(0===e.beacons.length)return[];let t=e.beacons.map(e=>e.id),n=(await y(t)).map(t=>{let n=e.beacons.find(e=>e.id===t.beacon_id);return{exhibition_id:t.exhibition_id,beacon_id:t.beacon_id,distance:null==n?void 0:n.distance,location:t.location}});return n.sort((e,t)=>{var n,i;let a=null!=(n=e.distance)?n:1/0,o=null!=(i=t.distance)?i:1/0;return a-o}),n}catch(e){return g.vF.error("Error detecting nearby exhibitions",{error:e instanceof Error?e.message:String(e)}),[]}}var I=n(41114);let x="homeService",k="home";async function E(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zh-TW",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"adult";if(await (0,_.j1)()){var n,i;g.vF.debug("[".concat(x,"] Using offline mode"),{locale:e,version:t});let a=await (0,f.Wy)(e,t);if(!a)throw Error("離線模式下無法取得首頁資料，請確認已下載離線資料包");return g.vF.debug("[".concat(x,"] Package themes data"),{themesCount:null==(n=a.themes)?void 0:n.length,themesUrls:null==(i=a.themes)?void 0:i.map(e=>{var t,n,i,a,o,r,l,c;return{uid:e.uid,name:e.name,imgUrl:(null==(o=e.img_key_vision)||null==(a=o.info)||null==(i=a[0])||null==(n=i.media_sources)||null==(t=n[0])?void 0:t.url)||(null==(c=e.img_key_vision)||null==(l=c.info)||null==(r=l[0])?void 0:r.value)||"NO_URL"}})}),d(a)}let a=(0,I.lM)(k,e,t),o=await (0,v.$4)(e,t),r=s.Sn.HOME({venue_uid:o,lang:e,content_type:t});return d(await (0,I.If)({endpoint:r,storageKey:a,serviceName:x,errorMessage:"無法取得首頁資料，請檢查網路連線"}))}async function S(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zh-TW",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"adult",n=(0,I.lM)(k,e,t),i=await (0,v.$4)(e,t),a=s.Sn.HOME({venue_uid:i,lang:e,content_type:t});return d(await (0,I.K)({endpoint:a,storageKey:n}))}async function T(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zh-TW",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"adult",n=(0,I.lM)(k,e,t);await (0,I.LH)(n)}var M=n(93257);function W(e){var t,n;if("video"!==e.type)return;let i=null==(t=e.info)?void 0:t[0],a=null==i||null==(n=i.media_sources)?void 0:n[0],o=(null==a?void 0:a.url)||(null==i?void 0:i.value);if(o)return{videoURL:o,thumbnail:o,title:e.name}}function N(e){var t,n;let i=e.venue_location,a=i.name,o=(null==(t=i.spaces[0])?void 0:t.name)||"",l=null==(n=i.spaces[0])?void 0:n.uid,c=(0,r.Ru)(e.media_audio_guidances),u=(0,r.e1)(e.media_sign_language_guidances),d=(0,r.r8)(e.media_audio_descriptions),s=e.map_location?{x:e.map_location.x,y:e.map_location.y}:void 0;return{workID:e.uid,image:e.medias[0]?(0,r.eN)(e.medias[0]):"",title:e.name,floor:a,room:o,location:(0,r.Aw)(i),audioDuration:c.duration,audioUrl:c.url,audioContentID:c.id,signLanguageDuration:u.duration,signLanguageUrl:u.url,signLanguageContentID:u.id,audioDescriptionDuration:d.duration,audioDescriptionUrl:d.url,audioDescriptionContentID:d.id,has3DModel:e.model_3ds&&e.model_3ds.length>0,exhibitionID:e.exhibition_uid,exhibitionName:e.exhibition_name,mapLocation:s,spaceUid:l}}function U(e){var t;let n=e.venue_location,i=n.name,a=(null==(t=n.spaces[0])?void 0:t.name)||"";return{workID:e.uid,image:e.medias[0]?(0,r.eN)(e.medias[0]):"",title:e.name,floor:i,room:a,location:(0,r.Aw)(n)}}function F(e){let t=e.works||[],n={categoryID:"all",categoryName:"全部展品",works:t.map(N)},i=t.slice(0,5).map(U);return{basicInfo:function(e){let t=e.medias.map(W).filter(e=>void 0!==e);return{tourID:e.uid,type:"theme",title:e.name,bannerImage:(0,r.eN)(e.img_key_vision),description:e.description,targetAudience:e.target_audience,videos:t.length>0?t:void 0}}(e),recommendStayTime:Math.round(e.duration_sec/60),workCategories:t.length>0?[n]:[],featuredWorks:i}}let C="tourService",z="tour";async function A(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"zh-TW",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"adult";if(await (0,_.j1)()){g.vF.debug("[".concat(C,"] Using offline mode"),{tourID:e,locale:t,version:n});let i=await (0,f.sz)(e,t,n);if(!i)throw Error("離線模式下無法取得導覽資料（ID: ".concat(e,"），請確認已下載離線資料包"));return F(i)}let i=(0,I.lM)("".concat(z,"_").concat(e),t,n),a=s.Sn.TOUR_DETAIL(e,{lang:t,content_type:n});return F(await (0,I.If)({endpoint:a,storageKey:i,serviceName:C,errorMessage:"無法取得導覽資料（ID: ".concat(e,"），請檢查網路連線")}))}async function L(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"zh-TW",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"adult",i=(0,I.lM)("".concat(z,"_").concat(e),t,n),a=s.Sn.TOUR_DETAIL(e,{lang:t,content_type:n});return F(await (0,I.K)({endpoint:a,storageKey:i}))}async function O(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"zh-TW",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"adult",i=(0,I.lM)("".concat(z,"_").concat(e),t,n);await (0,I.LH)(i)}var R=function(e){return e.PHOTO="photo",e.VIDEO="video",e}({});function H(e){let t=e.media_files.filter(e=>e.type===R.PHOTO);if(t.length>1)return{blockID:e.id,title:e.title||null,content:e.content||null,images:t.map(e=>({url:e.url,alt:e.alt_text||void 0}))};let n=t[0];return{blockID:e.id,title:e.title||null,content:e.content||null,image:null==n?void 0:n.url,imageAlt:(null==n?void 0:n.alt_text)||void 0}}function $(e){return{overview:{blocks:e.overview.map(H)},visitorInfo:function(e){let t=[];return e.contact_info&&t.push({itemID:"contact",icon:"phone",title:"聯絡資訊",cards:[{cardID:"contact-1",title:"聯絡方式",subtitle:e.contact_info}]}),t.push({itemID:"opening-hours",icon:"schedule",title:"開放時間",cards:[function(e){let t=e.open_hour_items.map(e=>"".concat(e.day_range,": ").concat(e.time_range));return e.extra_description&&t.push(e.extra_description),{cardID:e.id,title:"開放時間",details:t}}(e.opening_hours)]}),e.ticket_info.length>0&&t.push({itemID:"ticket-info",icon:"confirmation_number",title:"票價資訊",cards:e.ticket_info.map(e=>({cardID:e.id,tag:e.price,title:e.ticket_type,subtitle:e.price,details:e.note||void 0}))}),{items:t}}(e)}}let j="aboutService",B="about";async function K(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"zh-TW",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"adult";if(await (0,_.j1)()){g.vF.debug("[".concat(j,"] Using offline mode"),{locale:t,version:n});let e=await (0,f.er)(t,n);if(!e)throw Error("離線模式下無法取得認識場館資料，請確認已下載離線資料包");return $(e)}let i=(0,I.lM)("".concat(B,"_").concat(e),t,n),a=s.Sn.VENUE_INFO(e,{lang:t,content_type:n});return $(await (0,I.If)({endpoint:a,storageKey:i,serviceName:j,errorMessage:"無法取得認識場館資料，請檢查網路連線"}))}async function P(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"zh-TW",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"adult",i=(0,I.lM)("".concat(B,"_").concat(e),t,n),a=s.Sn.VENUE_INFO(e,{lang:t,content_type:n});return $(await (0,I.K)({endpoint:a,storageKey:i}))}async function V(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"zh-TW",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"adult",i=(0,I.lM)("".concat(B,"_").concat(e),t,n);await (0,I.LH)(i)}var X=n(28353);function Y(e){var t,n;let i=e.venue_location,a=i.name,o=(null==(t=i.spaces[0])?void 0:t.name)||"",l=null==(n=i.spaces[0])?void 0:n.uid,c=(0,r.Ru)(e.media_audio_guidances),u=(0,r.e1)(e.media_sign_language_guidances),d=(0,r.r8)(e.media_audio_descriptions),s=e.map_location?{x:e.map_location.x,y:e.map_location.y}:void 0;return{workID:e.uid,number:e.exhibit_number,image:e.medias[0]?(0,r.eN)(e.medias[0]):"",title:e.name,exhibitionID:e.exhibition_uid||"",exhibitionTitle:e.exhibition_name,floor:a,room:o,location:(0,r.Aw)(i),audioDuration:c.duration,audioURL:c.url,audioContentID:c.id,signLanguageDuration:u.duration,signLanguageURL:u.url,signLanguageContentID:u.id,audioDescriptionDuration:d.duration,audioDescriptionURL:d.url,audioDescriptionContentID:d.id,has3DModel:e.model_3ds&&e.model_3ds.length>0,mapLocation:s,spaceUid:l}}function J(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3?arguments[3]:void 0,a=i||e.length;return{data:e.map(Y),total:e.length,page:n,pageSize:a,query:t}}let Z="workSearchService";async function q(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"zh-TW",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"adult",i=arguments.length>3?arguments[3]:void 0;if(await (0,_.j1)()){g.vF.debug("[".concat(Z,"] Using offline mode"),{exhibitNumber:e,locale:t,version:n});try{let i=await (0,f.IZ)(e,t,n);if(!i)return g.vF.debug("[".concat(Z,"] Work not found in package"),{exhibitNumber:e}),[];if(!i.exhibition_name&&i.exhibition_uid){let a=(await (0,f.nD)(t,n)).find(e=>e.uid===i.exhibition_uid);a&&(i.exhibition_name=a.name,g.vF.debug("[".concat(Z,"] Resolved exhibition_name from package"),{exhibitNumber:e,exhibitionUid:i.exhibition_uid,exhibitionName:a.name}))}return J([i],e).data}catch(t){return g.vF.error("[".concat(Z,"] Offline search error"),{error:t instanceof Error?t.message:String(t),exhibitNumber:e}),[]}}try{let a=await (0,v.$4)(t,n),o=s.Sn.WORK_SEARCH(e,{venue_uid:a,exhibition_uid:i,lang:t,content_type:n}),r=m.$W.apiUrl||"http://localhost:3020/api",l=new URL(o,r).toString();g.vF.debug("[".concat(Z,"] Searching work by number"),{exhibitNumber:e,locale:t,version:n,exhibitionUid:i});let c=await fetch(l);if(!c.ok)return g.vF.warn("[".concat(Z,"] Search failed"),{status:c.status,statusText:c.statusText}),[];let u=await c.json(),d=[];if(u.success&&Array.isArray(u.data))d=u.data;else{if(!Array.isArray(u))return g.vF.warn("[".concat(Z,"] Unexpected response format"),{data:u}),[];d=u}return J(d,e).data}catch(n){return g.vF.error("[".concat(Z,"] Search error"),{error:n instanceof Error?n.message:String(n),exhibitNumber:e,locale:t}),[]}}async function G(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"zh-TW",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"adult";g.vF.debug("[".concat(Z,"] Clear cache (no-op)"),{exhibitNumber:e,locale:t,version:n})}let Q="mapService",ee="venue_areas",et="venue_exhibitions";async function en(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zh-TW";if(await (0,_.j1)()){g.vF.debug("[".concat(Q,"] Using offline mode for areas"),{locale:e});let t=await (0,f.dg)(e);return g.vF.debug("[".concat(Q,"] Areas loaded from package"),{areasCount:t.length}),t}let t=(0,I.lM)(ee,e),n=await (0,v.$4)(e,"adult"),i=s.Sn.VENUE_MAP({venue_uid:n,lang:e});return(await (0,I.If)({endpoint:i,storageKey:t,serviceName:Q,errorMessage:"無法取得場館地圖資料，請檢查網路連線"})).areas||[]}async function ei(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zh-TW",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"adult";if(await (0,_.j1)()){g.vF.debug("[".concat(Q,"] Using offline mode for exhibitions"),{locale:e,version:t});let n=await (0,f.nD)(e,t);return g.vF.debug("[".concat(Q,"] Exhibitions loaded from package"),{exhibitionsCount:n.length}),n}let n=(0,I.lM)(et,e,t),i=await (0,v.$4)(e,t),a=s.Sn.CURRENT_EXHIBITIONS({venue_uid:i,lang:e,content_type:t});return(await (0,I.If)({endpoint:a,storageKey:n,serviceName:Q,errorMessage:"無法取得展覽列表，請檢查網路連線"})).exhibitions||[]}async function ea(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zh-TW",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"adult",[n,i]=await Promise.all([en(e),ei(e,t)]);return g.vF.debug("[".concat(Q,"] Map data loaded"),{areasCount:n.length,exhibitionsCount:i.length}),{areas:n,exhibitions:i}}async function eo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zh-TW",t=(0,I.lM)(ee,e),n=await (0,v.$4)(e,"adult"),i=s.Sn.VENUE_MAP({venue_uid:n,lang:e});return(await (0,I.K)({endpoint:i,storageKey:t})).areas||[]}async function er(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zh-TW",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"adult",n=(0,I.lM)(et,e,t),i=await (0,v.$4)(e,t),a=s.Sn.CURRENT_EXHIBITIONS({venue_uid:i,lang:e,content_type:t});return(await (0,I.K)({endpoint:a,storageKey:n})).exhibitions||[]}async function el(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zh-TW",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"adult",[n,i]=await Promise.all([eo(e),er(e,t)]);return{areas:n,exhibitions:i}}async function ec(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zh-TW",t=(0,I.lM)(ee,e);await (0,I.LH)(t)}async function eu(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zh-TW",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"adult",n=(0,I.lM)(et,e,t);await (0,I.LH)(n)}async function ed(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zh-TW",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"adult";await Promise.all([ec(e),eu(e,t)])}function es(){let e=(0,a.Ym)(),{version:t}=(0,o.t)(),n=(0,i.useMemo)(()=>({getData:()=>E(e,t),refresh:()=>S(e,t),clearCache:()=>T(e,t)}),[e,t]),r=(0,i.useMemo)(()=>({getDetail:n=>M.nW(n,e,t),refresh:n=>M._A(n,e,t),clearCache:n=>M.JJ(n,e,t)}),[e,t]),l=(0,i.useMemo)(()=>({getDetail:n=>A(n,e,t),refresh:n=>L(n,e,t),clearCache:n=>O(n,e,t)}),[e,t]),c=(0,i.useMemo)(()=>({getData:n=>K(n,e,t),refresh:n=>P(n,e,t),clearCache:n=>V(n,e,t)}),[e,t]),u=(0,i.useMemo)(()=>({searchByNumber:(n,i)=>q(n,e,t,i),clearCache:n=>G(n,e,t)}),[e,t]),d=(0,i.useMemo)(()=>({getDetail:n=>X.pV(n,e,t),refresh:n=>X.EZ(n,e,t),clearCache:n=>X.LY(n,e,t)}),[e,t]),s=(0,i.useMemo)(()=>({get:()=>v.yV(e,t),refresh:()=>v.X5(e,t),clearCache:()=>v.dj(e,t),getDefaultVenueUid:()=>v.$4(e,t)}),[e,t]),g=(0,i.useMemo)(()=>({detectNearbyExhibitions:()=>D(),startScan:()=>p(),stopScan:()=>w()}),[]),h=(0,i.useMemo)(()=>({getData:()=>ea(e,t),refresh:()=>el(e,t),clearCache:()=>ed(e,t)}),[e,t]);return{locale:e,version:t,home:n,exhibition:r,tour:l,about:c,workSearch:u,work:d,systemInfo:s,beacon:g,map:h}}}}]);